"use strict";(self.webpackChunk_meridian_cfi_specviz_website=self.webpackChunk_meridian_cfi_specviz_website||[]).push([[24],{3584:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>T,contentTitle:()=>D,default:()=>I,frontMatter:()=>P,metadata:()=>_,toc:()=>L});var o=n(1085),r=n(1184),s=n(7775),i=n(3399),a=n(4041),l=function(e){return e.Whale="\ud83d\udc0b",e.Shark="\ud83e\udd88",e.Pufferfish="\ud83d\udc21",e.Fish="\ud83d\udc20",e}(l||{}),c=function(e){return e.Annotate="annotate",e.Select="select",e.Zoom="zoom",e.Move="move",e}(c||{});function u(e){return(0,o.jsx)(h,{...e,children:(0,o.jsx)(f,{})})}const d=a.createContext(null);function x(){const e=a.useContext(d);if(null==e)throw Error("useContext must be used within a Provider");return e}function h(e){const[t,n]=a.useState(null),[r,i]=a.useState(c.Annotate),[l,u]=a.useState(null),[x,h]=a.useState(null),f=a.useMemo((()=>({seconds:s._0.time(0,l?.duration??0),hertz:s._0.frequency(2e4,0),percent:s._0.percent(1,-1)})),[l]);return a.useEffect((()=>{s.fP.load(e.audio).then(u)}),[e.audio]),a.useEffect((()=>{fetch(e.annotation).then((e=>e.json())).then((e=>h(new Map(e))))}),[e.annotation]),null==l?"Loading audio...":null==x?"Loading regions...":(0,o.jsx)(d.Provider,{value:{focus:t,spectrogram:e.spectrogram,tool:r,waveform:e.waveform,setFocus:n,setTool:i},children:(0,o.jsx)(s.fP.Provider,{buffer:l,children:(0,o.jsx)(s.pd.Provider,{children:(0,o.jsx)(s._0.Provider,{value:f,children:(0,o.jsx)(s.L7.Provider,{initRegions:x,render:j,children:(0,o.jsx)(k,{children:(0,o.jsx)(S,{children:(0,o.jsx)(s.LM.Provider,{children:e.children})})})})})})})})}function f(){return(0,o.jsxs)("div",{id:"app",children:[(0,o.jsx)(y,{}),(0,o.jsx)(m,{}),(0,o.jsx)(p,{}),(0,o.jsx)(R,{}),(0,o.jsx)(s.fP.Effect,{})]})}function m(){const e=x(),t="move"!=e.tool;return(0,o.jsxs)("div",{className:`annotation-tool tool-${e.tool}`,children:[(0,o.jsxs)(s.Zc.Provider,{xaxis:"seconds",yaxis:"hertz",children:[(0,o.jsx)("div",{className:"axis-x",children:(0,o.jsx)(M,{children:(0,o.jsx)(s._0.Horizontal,{})})}),(0,o.jsx)("div",{className:"spectrogram axis-y",children:(0,o.jsx)(E,{children:(0,o.jsx)(s._0.Vertical,{})})}),(0,o.jsx)("div",{className:"spectrogram navigator",children:(0,o.jsx)(z,{children:(0,o.jsx)(s.mD,{src:e.spectrogram})})}),(0,o.jsx)("div",{className:"spectrogram visualization",children:(0,o.jsx)(C,{children:(0,o.jsx)(s.Di,{id:"spec",showSelection:t,src:e.spectrogram})})})]}),(0,o.jsx)(s.LM.Transform,{fn:e=>({scroll:{x:e.scroll.x,y:0},zoom:{x:e.zoom.x,y:1}}),children:(0,o.jsxs)(s.Zc.Provider,{xaxis:"seconds",yaxis:"percent",children:[(0,o.jsx)("div",{className:"waveform axis-y",children:(0,o.jsx)(E,{children:(0,o.jsx)(s._0.Vertical,{})})}),(0,o.jsx)("div",{className:"waveform navigator",children:(0,o.jsx)(z,{children:(0,o.jsx)(s.mD,{src:e.waveform})})}),(0,o.jsx)("div",{className:"waveform visualization",children:(0,o.jsx)(C,{children:(0,o.jsx)(s.Di,{id:"wav",showSelection:t,src:e.waveform})})})]})})]})}function p(){const e=s.L7.useContext();return(0,o.jsxs)("table",{className:"annotation-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:(0,o.jsx)(A,{checked:e.selection.size==e.regions.size,indeterminate:e.selection.size>0&&e.selection.size!=e.regions.size,onChange:t=>e.setSelection(t.target.checked?new Set(e.regions.keys()):new Set)})}),(0,o.jsx)("th",{children:"Id"}),(0,o.jsx)("th",{children:"Label"}),(0,o.jsx)("th",{children:"Comment"}),(0,o.jsx)("th",{children:"Offset"}),(0,o.jsx)("th",{children:"Duration"}),(0,o.jsxs)("th",{children:["Freq",(0,o.jsx)("br",{}),"(min)"]}),(0,o.jsxs)("th",{children:["Freq",(0,o.jsx)("br",{}),"(max)"]}),(0,o.jsx)("th",{children:"Listen"})]})}),(0,o.jsx)("tbody",{children:Array.from(e.regions.values(),(e=>(0,o.jsx)(v,{region:e},e.id)))})]})}function v(e){const t=x(),n=s.fP.useContext(),r=s.L7.useContext();return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)(A,{checked:r.selection.has(e.region.id),onChange:t=>r.setSelection((n=>{const o=new Set(n);return t.target.checked?o.add(e.region.id):o.delete(e.region.id),o}))})}),(0,o.jsxs)("td",{children:[e.region.id.slice(0,8),"..."]}),(0,o.jsx)("td",{children:(0,o.jsxs)("select",{value:e.region.properties?.label??"-",onChange:t=>r.updateRegionProperties(e.region.id,(e=>({...e,label:"-"==t.target.value?void 0:t.target.value}))),style:{fontSize:"1rem"},children:[(0,o.jsx)("option",{value:"-",children:"-"}),Object.values(l).map((e=>(0,o.jsx)("option",{value:e,children:e},e)))]})}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{value:e.region.properties?.comment??"",onChange:t=>r.updateRegionProperties(e.region.id,(e=>({...e,comment:t.target.value}))),style:{width:"90%"}})}),(0,o.jsx)("td",{children:(0,o.jsx)(s.Nz.X,{region:e.region,label:"s"})}),(0,o.jsx)("td",{children:(0,o.jsx)(s.Nz.X2,{region:e.region,label:"s"})}),(0,o.jsx)("td",{children:(0,o.jsx)(s.Nz.Y2,{direction:-1,format:e=>(e/1e3).toFixed(3),label:"kHz",region:e.region})}),(0,o.jsx)("td",{children:(0,o.jsx)(s.Nz.Y1,{direction:-1,format:e=>(e/1e3).toFixed(3),label:"kHz",region:e.region})}),(0,o.jsx)("td",{children:!n.state.pause&&t.focus&&t.focus==e.region.id?(0,o.jsx)("button",{type:"button",onClick:()=>{n.transport.stop(),t.setFocus(null)},children:"stop"}):(0,o.jsx)("button",{type:"button",onClick:()=>{t.setFocus(e.region.id),n.transport.play()},children:"play"})})]})}function y(){return(0,o.jsxs)("div",{className:"controls",children:[(0,o.jsx)(g,{}),(0,o.jsx)(b,{}),(0,o.jsx)(w,{})]})}function g(){const e=x(),t=s.fP.useContext();return(0,o.jsxs)("div",{className:"controls-audio",children:[(0,o.jsx)("button",{type:"button",onClick:e=>t.transport.seek(0),children:"Rewind"}),(0,o.jsx)("button",{type:"button",onClick:e=>t.transport.play(),className:t.state.pause?"":"active",children:"Play"}),(0,o.jsx)("button",{type:"button",onClick:n=>{t.transport.stop(),e.setFocus(null)},className:t.state.pause?"active":"",children:"Stop"})]})}function w(){const e=x();return(0,o.jsx)("div",{className:"controls-tool",children:Object.entries(c).map((t=>{let[n,r]=t;return(0,o.jsx)("button",{type:"button",onClick:t=>e.setTool(r),className:e.tool==r?"active":"",children:n},r)}))})}function b(){const e=s.fP.useContext();return(0,o.jsxs)("div",{className:"audio-duration",children:[(0,o.jsx)(s.fP.Seek,{}),(0,o.jsx)("span",{children:"/"}),(0,o.jsx)("span",{children:i.vE(e.buffer?.duration??0)})]})}function j(e){const t="spec"==e.viewerId||"wav"==e.viewerId?[e.region.properties?.label??"UNK",e.region.properties?.comment??""]:[];return(0,o.jsxs)("svg",{...e.svgProps,children:[(0,o.jsx)("rect",{}),t.map(((e,t)=>(0,o.jsx)("text",{x:"4",y:String(4+24*t),children:e},String(t))))]})}function S(e){const t=s.fP.useContext(),n=a.useCallback((e=>{let{unit:n,rel:o,abs:r,xaxis:s,yaxis:i,event:a}=e;t.transport.seek(n.x)}),[t.transport.seek]);return(0,o.jsx)(s.rc.Provider,{children:e.children,onContextMenu:n})}function k(e){const t=x(),n=s.L7.useContext(),r=a.useCallback((e=>{const o=t.focus?n.regions.get(t.focus)??null:null;return null==o?e:{hpf:"hertz"===o.yunit?o.y:void 0,lpf:"hertz"===o.yunit?o.y+o.height:void 0,loop:[o.x,o.x+o.width]}}),[t.focus,n.regions]);return(0,o.jsx)(s.fP.TransformFx,{children:e.children,fn:r})}function z(e){const t=x(),n=s.LM.useContext(),r=a.useCallback((e=>{let{unit:o,rel:r,abs:s,xaxis:i,yaxis:a,event:l}=e;switch(t.tool){case"annotate":case"select":case"move":n.scrollTo({x:r.x*n.state.zoom.x-.5,y:r.y*n.state.zoom.y-.5});break;case"zoom":n.resetView()}}),[t.tool,n.resetView,n.scrollTo,n.state.zoom.x,n.state.zoom.y]),i=a.useCallback((e=>{let{dx:t,dy:o,event:r}=e;n.scroll(t*n.state.zoom.x,o*n.state.zoom.y)}),[n.scroll,n.state.zoom.x,n.state.zoom.y]),l=a.useCallback((e=>{let{dx:t,dy:o,event:r}=e;r.altKey?n.zoomScroll(t,o):n.scroll(-t,-o)}),[n.zoomScroll,n.scroll]);return(0,o.jsx)(s.rc.Provider,{children:e.children,onClick:r,onDrag:i,onWheel:l})}function C(e){const t=x(),n=s.L7.useContext(),r=s.LM.useContext(),l=a.useCallback((e=>{let{dx:t,dy:n,event:o}=e;o.altKey?r.zoomScroll(-t,-n):r.scroll(t,n)}),[r.zoomScroll,r.scroll]),u=a.useMemo((()=>{switch(t.tool){case c.Annotate:return{onClick:e=>{let{unit:t,rel:o,abs:r,xaxis:i,yaxis:a,event:l}=e;n.selectPoint(r,s.L7.selectionMode(l))},onRect:e=>{let{unit:t,rel:o,abs:r,xaxis:s,yaxis:a,event:l}=e;n.create("hertz"===a.unit?{...t,id:i.po(10),xunit:s.unit,yunit:a.unit}:{...t,y:0,height:2e4,id:i.po(10),xunit:s.unit,yunit:"hertz"})},onWheel:l};case c.Select:return{onClick:e=>{let{unit:t,rel:o,abs:r,xaxis:i,yaxis:a,event:l}=e;n.selectPoint(r,s.L7.selectionMode(l))},onRect:e=>{let{unit:t,rel:o,abs:r,xaxis:i,yaxis:a,event:l}=e;n.selectArea(r,s.L7.selectionMode(l))},onWheel:l};case c.Zoom:return{onClick:e=>{let{unit:t,rel:n,abs:o,xaxis:i,yaxis:a,event:l}=e;r.zoomPoint(o,l.ctrlKey||l.metaKey?s.LM.ZoomDirection.out:s.LM.ZoomDirection.in)},onRect:e=>{let{unit:t,rel:n,abs:o,xaxis:s,yaxis:i,event:a}=e;r.zoomArea(o)},onWheel:l};case c.Move:return{onDrag:e=>{let{dx:t,dy:o,event:s}=e;0==n.selection.size?r.scroll(-t,-o):n.moveSelection(t/r.state.zoom.x,o/r.state.zoom.y)},onWheel:l}}}),[l,t.tool,n.create,n.moveSelection,n.selectArea,n.selectPoint,n.selection,r.scroll,r.state.zoom.x,r.state.zoom.y,r.zoomArea,r.zoomPoint]);return(0,o.jsx)(s.rc.Provider,{children:e.children,...u})}function M(e){const t=s.LM.useContext(),n=a.useCallback((e=>{let{dx:n,dy:o,event:r}=e;r.altKey?t.zoomScroll(o,0):t.zoomScroll(-o,0)}),[t.zoomScroll]);return(0,o.jsx)(s.rc.Provider,{children:e.children,onWheel:n})}function E(e){const t=s.LM.useContext(),n=a.useCallback((e=>{let{dx:n,dy:o,event:r}=e;r.altKey?t.zoomScroll(0,o):t.zoomScroll(0,-o)}),[t.zoomScroll]);return(0,o.jsx)(s.rc.Provider,{children:e.children,onWheel:n})}function R(){const e=s.L7.useContext();return(0,o.jsxs)(s.jW,{children:[(0,o.jsx)(s.DA,{bind:"Escape",onKeyDown:e.deselect}),(0,o.jsx)(s.DA,{bind:"ArrowLeft",onKeyDown:t=>{t.preventDefault(),e.moveSelection(-.01,0)}}),(0,o.jsx)(s.DA,{bind:"ArrowRight",onKeyDown:t=>{t.preventDefault(),e.moveSelection(.01,0)}}),(0,o.jsx)(s.DA,{bind:"ArrowUp",onKeyDown:t=>{t.preventDefault(),e.moveSelection(0,-.03)}}),(0,o.jsx)(s.DA,{bind:"ArrowDown",onKeyDown:t=>{t.preventDefault(),e.moveSelection(0,.03)}})]})}function A(e){let{indeterminate:t,...n}=e;const r=a.useRef(null);return a.useEffect((()=>{r.current&&(r.current.indeterminate=t??!1)}),[t]),(0,o.jsx)("input",{...n,ref:r,type:"checkbox"})}var N=n(9359);const P={sidebar_position:5,tags:["action","audio","axis","input","note","plane","viewport"]},D="Advanced Annotation",_={id:"examples/advanced-annotation",title:"Advanced Annotation",description:"Explore advanced features of Specviz.",source:"@site/docs/examples/advanced-annotation.mdx",sourceDirName:"examples",slug:"/examples/advanced-annotation",permalink:"/specviz/docs/examples/advanced-annotation",draft:!1,unlisted:!1,tags:[{inline:!0,label:"action",permalink:"/specviz/docs/tags/action"},{inline:!0,label:"audio",permalink:"/specviz/docs/tags/audio"},{inline:!0,label:"axis",permalink:"/specviz/docs/tags/axis"},{inline:!0,label:"input",permalink:"/specviz/docs/tags/input"},{inline:!0,label:"note",permalink:"/specviz/docs/tags/note"},{inline:!0,label:"plane",permalink:"/specviz/docs/tags/plane"},{inline:!0,label:"viewport",permalink:"/specviz/docs/tags/viewport"}],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,tags:["action","audio","axis","input","note","plane","viewport"]},sidebar:"mainSidebar",previous:{title:"Interactive Spectrogram",permalink:"/specviz/docs/examples/interactive-spectrogram"}},T={},L=[];function $(e){const t={div:"div",h1:"h1",header:"header",p:"p",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"advanced-annotation",children:"Advanced Annotation"})}),"\n",(0,o.jsx)(t.p,{children:"Explore advanced features of Specviz."}),"\n","\n",(0,o.jsx)(N.A,{fallback:(0,o.jsx)(t.div,{children:"Loading..."}),children:e=>(0,o.jsx)(u,{audio:e("/audio.flac"),annotation:e("/advanced-annotation.json"),spectrogram:e("/spectrogram.png"),waveform:e("/waveform.png")})})]})}function I(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)($,{...e})}):$(e)}},9359:(e,t,n)=>{n.d(t,{A:()=>a});n(4041);var o=n(213),r=n(1085);function s(e){let{children:t,fallback:n}=e;return(0,o.A)()?(0,r.jsx)(r.Fragment,{children:t?.()}):n??null}var i=n(396);function a(e){const{siteConfig:t}=(0,i.A)();return(0,r.jsx)(s,{children:()=>e.children((e=>t.baseUrl+e),t),fallback:(0,r.jsx)("div",{children:"Loading..."})})}},1184:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var o=n(4041);const r={},s=o.createContext(r);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:t},e.children)}},3399:(e,t,n)=>{function o(e){return e<1e3?e.toFixed(0)+" Hz":(e/1e3).toFixed(3)+" kHz"}function r(e){return(100*e).toFixed(3)+"%"}function s(e){const t=Math.floor(e/60);return`${t}:${(e-t).toFixed(3).padStart(2,"0")}`}function i(e){const t=new Uint8Array(e);return window.crypto.getRandomValues(t),Array.from(t,(e=>e.toString(16).padStart(2,"0"))).join("")}n.d(t,{KN:()=>r,hz:()=>o,po:()=>i,vE:()=>s})},7775:(e,t,n)=>{n.d(t,{rc:()=>l,fP:()=>ie,_0:()=>B,jW:()=>he,Nz:()=>ve,pd:()=>y,DA:()=>fe,mD:()=>ge,L7:()=>te,Zc:()=>A,LM:()=>C,Di:()=>be});var o=n(1085),r=n(4041);const s={},i=r.createContext(s);function a(){return r.useContext(i)}const l=Object.freeze(Object.defineProperty({__proto__:null,Provider:function(e){const t=r.useContext(i),n=r.useMemo((()=>({...t,...e})),[t,e]);return(0,o.jsx)(i.Provider,{children:e.children,value:n})},useContext:a},Symbol.toStringTag,{value:"Module"}));var c=n(3399);function u(e,t){return{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),width:Math.abs(t.x-e.x),height:Math.abs(t.y-e.y)}}function d(e,t,n){return{x:t?e.x:0,y:n?e.y:0,width:t?e.width:1,height:n?e.height:1}}function x(e,t,n,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=0);let r=e,s=t,i=n,a=o;return{abs:{get x(){return r},set x(e){r=e},get y(){return s},set y(e){s=e}},rel:{get x(){return i},set x(e){i=e},get y(){return a},set y(e){a=e}}}}const h={x:0,y:0};function f(e,t){void 0===e&&(e=0),void 0===t&&(t=0);let n=e,o=t;return{get x(){return n},get y(){return o},set x(e){n=e},set y(e){o=e}}}const m={input:{alt:!1,buttons:0,focus:null,xaxis:null,yaxis:null},mousedown:{abs:h,rel:h},mouseup:{abs:h,rel:h},unitDown:h,unitUp:h},p=r.createContext(m);function v(){return r.useContext(p)}const y=Object.freeze(Object.defineProperty({__proto__:null,Provider:function(e){const t=r.useMemo((()=>{let e=0,t=!1,n=null,o=null,r=null;return{get buttons(){return e},set buttons(t){e=t},get alt(){return t},set alt(e){t=e},get focus(){return n},set focus(e){n=e},get xaxis(){return o},set xaxis(e){o=e},get yaxis(){return r},set yaxis(e){r=e}}}),[]),n=r.useMemo(x,[]),s=r.useMemo(x,[]),i=r.useMemo(f,[]),a=r.useMemo(f,[]),l={input:t,mousedown:n,mouseup:s,unitDown:i,unitUp:a};return r.useEffect((()=>{function e(e){"Alt"==e.key&&(t.alt=!0)}function n(e){"Alt"==e.key&&(t.alt=!1)}return window.addEventListener("keydown",e),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",n)}}),[t]),(0,o.jsx)(p.Provider,{children:e.children,value:l})},useContext:v},Symbol.toStringTag,{value:"Module"}));function g(e,t,n){return Math.min(Math.max(e,t),n)}var w=(e=>(e[e.out=0]="out",e[e.in=1]="in",e))(w||{});const b={state:{scroll:{x:0,y:0},zoom:{x:1,y:1}},resetView:()=>{throw Error("resetView called outside of context")},scroll:()=>{throw Error("scroll called outside of context")},scrollTo:()=>{throw Error("scrollTo called outside of context")},zoom:()=>{throw Error("zoom called outside of context")},zoomArea:()=>{throw Error("zoomArea called outside of context")},zoomPoint:()=>{throw Error("zoomPoint called outside of context")},zoomScroll:()=>{throw Error("zoomScroll called outside of context")}},j=10,S=10,k=r.createContext(b);function z(){return r.useContext(k)}const C=Object.freeze(Object.defineProperty({__proto__:null,Provider:function(e){const t=v(),[n,s]=r.useState(b.state),i=r.useCallback((()=>{s(b.state)}),[]),a=r.useCallback(((e,t)=>{s((n=>({...n,scroll:{x:g(n.scroll.x+e,0,n.zoom.x-1),y:g(n.scroll.y+t,0,n.zoom.y-1)}})))}),[]),l=r.useCallback((e=>{s((t=>({...t,scroll:{x:g(e.x,0,t.zoom.x-1),y:g(e.y,0,t.zoom.y-1)}})))}),[]),c=r.useCallback(((e,t)=>{s((n=>({...n,zoom:{x:g(n.zoom.x+e,1,j),y:g(n.zoom.y+t,1,S)}})))}),[]),u=r.useCallback((e=>{s((t=>{const n=g(1/e.width,1,j),o=g(1/e.height,1,S);return{zoom:{x:n,y:o},scroll:{x:g((e.x+e.width/2)*n-.5,0,n-1),y:g((e.y+e.height/2)*o-.5,0,o-1)}}}))}),[]),d=r.useCallback(((e,t)=>{s((n=>{const o=0==t?-.5:.5,r=e.x*n.zoom.x-n.scroll.x,s=e.y*n.zoom.y-n.scroll.y,i=g(n.zoom.x+o,1,j),a=g(n.zoom.y+o,1,S);return{zoom:{x:i,y:a},scroll:{x:g(e.x*i-r,0,i-1),y:g(e.y*a-s,0,a-1)}}}))}),[]),x=r.useCallback(((e,n)=>{s((o=>{const r=g(o.zoom.x+e,1,j),s=g(o.zoom.y+n,1,S);return{zoom:{x:r,y:s},scroll:{x:g(t.mousedown.abs.x*r-t.mousedown.rel.x,0,r-1),y:g(t.mousedown.abs.y*s-t.mousedown.rel.y,0,s-1)}}}))}),[t.mousedown.abs,t.mousedown.rel]),h=r.useMemo((()=>({resetView:i,scroll:a,scrollTo:l,state:n,zoom:c,zoomArea:u,zoomPoint:d,zoomScroll:x})),[i,a,l,n,c,u,d,x]);return(0,o.jsx)(k.Provider,{children:e.children,value:h})},Transform:function(e){const t=z(),n=r.useMemo((()=>{const n=e.fn(t.state);return{...t,state:n}}),[t,e.fn]);return(0,o.jsx)(k.Provider,{children:e.children,value:n})},ZoomDirection:w,useContext:z},Symbol.toStringTag,{value:"Module"})),M={xaxis:Y(0,100,"x"),yaxis:Y(0,100,"y")},E=r.createContext(M);function R(){return r.useContext(E)}const A=Object.freeze(Object.defineProperty({__proto__:null,Provider:function(e){const t=X(),n=t[e.xaxis],r=t[e.yaxis];if(null==n)throw Error(`axis not found: ${e.xaxis}`);if(null==r)throw Error(`axis not found: ${e.yaxis}`);return(0,o.jsx)(E.Provider,{children:e.children,value:{xaxis:n,yaxis:r}})},useContext:R},Symbol.toStringTag,{value:"Module"}));function N(e){r.useEffect((()=>{let t;return t=window.requestAnimationFrame((function n(o){e(o),t=window.requestAnimationFrame(n)})),()=>{window.cancelAnimationFrame(t)}}),[e])}function P(e){const t=v(),n=R();return function(e){const t=R(),n=v(),o=z(),s=r.useCallback((t=>{var n;t.preventDefault(),null==(n=e.onContextMenu)||n.call(e,t)}),[e.onContextMenu]),i=r.useCallback((t=>{var o;t.preventDefault(),n.input.buttons=t.buttons,null==(o=e.onMouseDown)||o.call(e,t)}),[n.input,e.onMouseDown]),a=r.useCallback((r=>{var s;const i=r.currentTarget.getBoundingClientRect(),a=(r.clientX-i.x)/i.width,l=(r.clientY-i.y)/i.height;1&n.input.buttons?(n.mouseup.rel.x=a,n.mouseup.rel.y=l,n.mouseup.abs.x=(a+o.state.scroll.x)/o.state.zoom.x,n.mouseup.abs.y=(l+o.state.scroll.y)/o.state.zoom.y,n.unitUp.x=T(t.xaxis,g(n.mouseup.abs.x,0,1)),n.unitUp.y=T(t.yaxis,g(n.mouseup.abs.y,0,1))):(n.mousedown.rel.x=n.mouseup.rel.x=a,n.mousedown.rel.y=n.mouseup.rel.y=l,n.mousedown.abs.x=n.mouseup.abs.x=(a+o.state.scroll.x)/o.state.zoom.x,n.mousedown.abs.y=n.mouseup.abs.y=(l+o.state.scroll.y)/o.state.zoom.y,n.unitDown.x=n.unitUp.x=T(t.xaxis,g(n.mousedown.abs.x,0,1)),n.unitDown.y=n.unitUp.y=T(t.yaxis,g(n.mousedown.abs.y,0,1))),null==(s=e.onMouseMove)||s.call(e,r)}),[n.input,n.mousedown,n.mouseup,t.xaxis,t.yaxis,e.onMouseMove,n.unitDown,n.unitUp,o.state.scroll.x,o.state.scroll.y,o.state.zoom.x,o.state.zoom.y]),l=r.useCallback((t=>{var o;null==(o=e.onMouseUp)||o.call(e,t),n.input.buttons=0}),[n.input,e.onMouseUp]),c=r.useCallback((o=>{var r;n.input.focus=o.currentTarget,null!=t.xaxis&&(n.input.xaxis=t.xaxis),null!=t.yaxis&&(n.input.yaxis=t.yaxis),null==(r=e.onMouseEnter)||r.call(e,o)}),[n.input,t.xaxis,t.yaxis,e.onMouseEnter]),u=r.useCallback((t=>{var o;null==(o=e.onMouseLeave)||o.call(e,t),n.input.buttons=0,n.input.focus=null,n.input.xaxis=null,n.input.yaxis=null}),[n.input,e.onMouseLeave]);return r.useMemo((()=>({onContextMenu:s,onMouseDown:i,onMouseMove:a,onMouseUp:l,onMouseEnter:c,onMouseLeave:u})),[s,i,a,l,c,u])}({onMouseMove:r.useCallback((n=>{var o;if(1&t.input.buttons){const t=n.movementX/n.currentTarget.clientWidth,r=n.movementY/n.currentTarget.clientHeight;null==(o=e.onDrag)||o.call(e,{dx:t,dy:r,event:n})}}),[t.input,e.onDrag]),onMouseUp:r.useCallback((o=>{var r,s,i,a;if(1&t.input.buttons){const i=u(t.mousedown.abs,t.mouseup.abs);a=i,Math.sqrt(a.width**2+a.height**2)<.01?null==(r=e.onClick)||r.call(e,{event:o,unit:t.unitUp,rel:t.mouseup.rel,abs:t.mouseup.abs,xaxis:n.xaxis,yaxis:n.yaxis}):null==(s=e.onRect)||s.call(e,{event:o,unit:u(t.unitDown,t.unitUp),rel:u(t.mousedown.rel,t.mouseup.rel),abs:i,xaxis:n.xaxis,yaxis:n.yaxis})}else 2&t.input.buttons&&(null==(i=e.onContextMenu)||i.call(e,{event:o,unit:t.unitUp,rel:t.mouseup.rel,abs:t.mouseup.abs,xaxis:n.xaxis,yaxis:n.yaxis}))}),[t.input,t.mousedown,t.mouseup,t.unitDown,t.unitUp,n.xaxis,n.yaxis,e.onClick,e.onContextMenu,e.onRect])})}function D(e){const[t,n]=r.useState(h),o=r.useMemo((()=>new ResizeObserver((e=>{for(const t of e)for(const{blockSize:e,inlineSize:o}of t.borderBoxSize)n((t=>t.x===o&&t.y===e?t:{x:o,y:e}))}))),[]);return r.useLayoutEffect((()=>(e.current&&o.observe(e.current),()=>{o.disconnect()})),[o,e]),t}function _(e,t){const n=r.useCallback((n=>{if(e.current){n.preventDefault();const o=n.deltaX/e.current.clientWidth,r=n.deltaY/e.current.clientHeight;null==t||t({dx:o,dy:r,event:n})}}),[t,e]);r.useEffect((()=>(e.current&&e.current.addEventListener("wheel",n,{passive:!1}),()=>{e.current&&e.current.removeEventListener("wheel",n)})),[e,n])}function T(e,t){if(null==e)return Number.NEGATIVE_INFINITY;const{intervals:n}=e;if(n.length<2)return Number.NEGATIVE_INFINITY;let o,r,s,i,a=0;for(;a<n.length-1;){if([o,r]=n[a],[s,i]=n[a+1],o<=t&&t<=s)return r+(i-r)*(t-o)/(s-o);a+=1}return Number.NEGATIVE_INFINITY}function L(e,t){if(null==e)return Number.NEGATIVE_INFINITY;const n=[...e.intervals].sort(((e,t)=>{let[n,o]=e,[r,s]=t;return o-s}));if(n.length<2)return Number.NEGATIVE_INFINITY;let o,r,s,i,a=0;for(;a<n.length-1;){if([o,r]=n[a],[s,i]=n[a+1],r<=t&&t<=i)return o+(s-o)*(t-r)/(i-r);a+=1}return Number.NEGATIVE_INFINITY}function $(e){return(t,n,o)=>{const r=e(t,o.x),s=e(n,o.y);return i={x:r,y:s,width:e(t,o.x+o.width)-r,height:e(n,o.y+o.height)-s},{x:Math.min(i.x,i.x+i.width),y:Math.min(i.y,i.y+i.height),width:Math.abs(i.width),height:Math.abs(i.height)};var i}}const I=$(T),K=$(L);function U(e,t){const n=[];if(t<=0)return n;const o=e.intervals.at(0),r=e.intervals.at(-1);if(null==o||null==r)return n;const[s,i]=o[1]<r[1]?[o[1],r[1]]:[r[1],o[1]],a=Math.abs(i-s),l=Math.log10(a/t),c=Math.floor(l),u=l-c<=.69?5*10**c:1*10**(c+1);for(let d=s;d<i;d+=u)n.push([L(e,d),d]);return n}function F(e,t){return e.format(t)}function Y(e,t,n,o){return{unit:n??"units",format:o??String,intervals:[[0,e],[1,t]]}}const V={},O=r.createContext(V),W=O.Provider;function X(){return r.useContext(O)}const B=Object.freeze(Object.defineProperty({__proto__:null,Horizontal:function(e){const t=r.useRef(null),n=R(),s=D(t),i=a(),l=z();_(t,i.onWheel);const c=e.tickWidth??80,u=e.tickHeight??20,d=s.x*l.state.zoom.x,x=1*s.y,h=d/c,f=`0 0 ${d/Math.max(1,h)} ${u}`,m=r.useMemo((()=>Array.from(U(n.xaxis,h),(e=>{let[t,r]=e;return(0,o.jsxs)("svg",{className:"axis-tick axis-tick-x",x:String(t),y:1-u/x,width:String(1/h),height:String(u/x),viewBox:f,preserveAspectRatio:"none",children:[(0,o.jsx)("line",{x1:"1",y1:"0",x2:"1",y2:String(u)}),(0,o.jsx)("text",{x:"5",y:"5",children:F(n.xaxis,r)})]},r)}))),[x,Math.floor(h),n.xaxis,f,u]),p=`${`translate(${-l.state.scroll.x}, 0)`} ${`scale(${l.state.zoom.x}, 1)`}`;return(0,o.jsx)("svg",{ref:t,width:"100%",height:"100%",viewBox:"0 0 1 1",preserveAspectRatio:"none",overflow:"visible",children:(0,o.jsx)("g",{transform:p,children:m})})},Provider:W,Vertical:function(e){const t=r.useRef(null),n=R(),s=D(t),i=a(),l=z();_(t,i.onWheel);const c=e.tickWidth??80,u=e.tickHeight??20,d=1*s.x,x=s.y*l.state.zoom.y,h=x/u,f=`0 0 ${c} ${x/Math.max(1,h)}`,m=r.useMemo((()=>Array.from(U(n.yaxis,h),(e=>{let[t,r]=e;return(0,o.jsxs)("svg",{className:"axis-tick axis-tick-y",x:String(0),y:String(t),width:String(c/d),height:String(1/h),viewBox:f,preserveAspectRatio:"none",children:[(0,o.jsx)("line",{x1:String(.9*c),y1:"0",x2:String(c),y2:"0"}),(0,o.jsx)("text",{x:"5",y:"0",children:F(n.yaxis,r)})]},r)}))),[Math.floor(h),n.yaxis,f,d,c]),p=`${`translate(0, ${-l.state.scroll.y})`} ${`scale(1, ${l.state.zoom.y})`}`;return(0,o.jsx)("svg",{ref:t,width:"100%",height:"100%",viewBox:"0 0 1 1",preserveAspectRatio:"none",overflow:"visible",children:(0,o.jsx)("g",{transform:p,children:m})})},computeRect:I,computeRectInverse:K,computeUnit:T,computeUnitInverse:L,formatUnit:F,frequency:function(e,t,n,o){return void 0===n&&(n="hertz"),void 0===o&&(o=c.hz),Y(e,t,n,o)},linear:Y,nonlinear:function(e,t,n){return{unit:t??"units",format:n??String,intervals:e}},percent:function(e,t,n,o){return void 0===n&&(n="percent"),void 0===o&&(o=c.KN),Y(e,t,n,o)},time:function(e,t,n,o){return void 0===n&&(n="seconds"),void 0===o&&(o=c.vE),Y(e,t,n,o)},useContext:X},Symbol.toStringTag,{value:"Module"}));var q=(e=>(e.add="add",e.invert="invert",e.replace="replace",e.subtract="subtract",e))(q||{});function G(e,t,n){switch(n){case"invert":return e.symmetricDifference(t);case"add":return e.union(t);case"subtract":return e.difference(t);case"replace":return t}}const H={canCreate:!0,regions:new Map,selection:new Set,transformedRegions:new Map,transformedSelection:new Set,create(){throw Error("annotate called outside of context")},canDelete:()=>!0,canRead:()=>!0,canUpdate:()=>!0,deleteSelection(){throw Error("delete called outside of context")},deselect(){throw Error("deselect called outside of context")},moveSelection(){throw Error("moveSelection called outside of context")},selectArea(){throw Error("selectArea called outside of context")},selectId(){throw Error("selectId called outside of context")},selectPoint(){throw Error("selectPoint called outside of context")},setRectX(){throw Error("setRectX called outside of context")},setRectX1(){throw Error("setRectX1 called outside of context")},setRectX2(){throw Error("setRectX2 called outside of context")},setRectY(){throw Error("setRectY called outside of context")},setRectY1(){throw Error("setRectY1 called outside of context")},setRectY2(){throw Error("setRectY2 called outside of context")},setRegions(){throw Error("setRegions called outside of context")},setSelection(){throw Error("setSelection called outside of context")},updateRegion(){throw Error("updateRegion called outside of context")},updateRegionProperties(){throw Error("updateRegionProperties called outside of context")},updateSelectedRegions(){throw Error("updateSelectedRegions called outside of context")}},Z=r.createContext(H);function Q(){return r.useContext(Z)}function J(e,t){const n=t[e.xunit],o=t[e.yunit];if(null==n)throw Error(`axis not found: ${e.xunit}`);if(null==o)throw Error(`axis not found: ${e.yunit}`);return K(n,o,e)}function ee(e){const t=Q(),n=R(),s=z(),i=e.children??t.render,a=r.useMemo((()=>{const t=d(K(n.xaxis,n.yaxis,e.region),n.xaxis.unit==e.region.xunit,n.yaxis.unit==e.region.yunit);if(Number.isNaN(t.x))return null;if(Number.isNaN(t.y))return null;if(Number.isNaN(t.width))return null;if(Number.isNaN(t.height))return null;const o=`0 0 ${t.width*e.dimensions.x*s.state.zoom.x} ${t.height*e.dimensions.y*s.state.zoom.y}`;return{className:e.selected?"annotation annotation-selected":"annotation",fontSize:"12pt",height:String(t.height),preserveAspectRatio:"none",viewBox:o,width:String(t.width),x:String(t.x),y:String(t.y)}}),[n.xaxis,n.yaxis,e.dimensions,e.region,e.selected,s.state.zoom]);return(0,o.jsx)(o.Fragment,{children:a&&(null==i?void 0:i({...e,svgProps:a}))})}const te=Object.freeze(Object.defineProperty({__proto__:null,Annotation:ee,Provider:function(e){const{input:t}=v(),n=X(),s=e.canCreate??H.canCreate,i=e.canDelete??H.canDelete,a=e.canRead??H.canRead,l=e.canUpdate??H.canUpdate,[c,u]=r.useState(e.initRegions??H.regions),[x,h]=r.useState(e.initSelection??H.selection),f=r.useMemo((()=>{const e=new Map;for(const[t,n]of c)a(n)&&e.set(t,n);return e}),[a,c]),m=r.useMemo((()=>new Set(x).intersection(f)),[x,f]),p=r.useCallback(((e,o)=>{h((r=>{var s,i;const a=new Set;for(const o of c.values()){const r=J(o,n);e(d(r,(null==(s=t.xaxis)?void 0:s.unit)==o.xunit,(null==(i=t.yaxis)?void 0:i.unit)==o.yunit))&&a.add(o.id)}return G(r,a,o??"replace")}))}),[n,t,c]),y=r.useCallback(((e,t)=>{const o=n[e.xunit],r=n[e.yunit];if(null==o)throw Error(`axis not found: ${e.xunit}`);if(null==r)throw Error(`axis not found: ${e.yunit}`);return{...e,...I(o,r,t(K(o,r,e)))}}),[n]),w=r.useCallback(((e,t)=>{s&&(u((t=>new Map(t).set(e.id,e))),(null==t?void 0:t.autoSelect)&&h(new Set([e.id])))}),[s]),b=r.useCallback((()=>{u((e=>{const t=new Map;for(const[n,o]of e)x.has(n)&&i(o)||t.set(n,o);return t})),h(new Set)}),[i,x]),j=r.useCallback((()=>{h(new Set)}),[]),S=r.useCallback(((e,n)=>{u((o=>new Map(Array.from(o,(o=>{let[r,s]=o;return x.has(r)&&l(s)?[r,y(s,(o=>{var r,i;return{x:g(o.x+((null==(r=t.xaxis)?void 0:r.unit)==s.xunit?e:0),0,1-o.width),y:g(o.y+((null==(i=t.yaxis)?void 0:i.unit)==s.yunit?n:0),0,1-o.height),width:o.width,height:o.height}}))]:[r,s]})))))}),[l,t,x,y]),k=r.useCallback(((e,t)=>{p((t=>null!=function(e,t){const n=Math.max(e.x,t.x),o=Math.max(e.y,t.y),r=Math.min(e.x+e.width,t.x+t.width)-n,s=Math.min(e.y+e.height,t.y+t.height)-o;return r<=0||s<=0?null:{x:n,y:o,width:r,height:s}}(t,e)),t)}),[p]),z=r.useCallback(((e,t)=>{h((n=>G(n,new Set([e]),t??"replace")))}),[]),C=r.useCallback(((e,t)=>{p((t=>function(e,t){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}(t,e)),t)}),[p]),M=r.useCallback(((e,t)=>{l(e)&&u((n=>new Map(n).set(e.id,y(e,(e=>({x:g(e.x+t,0,1-e.width),y:e.y,width:e.width,height:e.height}))))))}),[l,y]),E=r.useCallback((()=>{}),[]),R=r.useCallback(((e,t)=>{l(e)&&u((n=>new Map(n).set(e.id,y(e,(e=>({x:e.x,y:e.y,width:g(e.width+t,.01,1-e.x),height:e.height}))))))}),[l,y]),A=r.useCallback(((e,t)=>{l(e)&&u((n=>new Map(n).set(e.id,y(e,(e=>({x:e.x,y:g(e.y+t,0,1-e.height),width:e.width,height:e.height}))))))}),[l,y]),N=r.useCallback(((e,t)=>{l(e)&&u((n=>new Map(n).set(e.id,y(e,(e=>({x:e.x,y:g(e.y+t,0,e.y+e.height-.01),width:e.width,height:g(e.height-Math.max(t,-e.y),.01,1-e.y)}))))))}),[l,y]),P=r.useCallback(((e,t)=>{l(e)&&u((n=>new Map(n).set(e.id,y(e,(e=>({x:e.x,y:e.y,width:e.width,height:g(e.height+t,.01,1-e.y)}))))))}),[l,y]),D=r.useCallback(((e,t)=>{u((n=>{const o=n.get(e);return o&&l(o)?new Map(n).set(e,"function"==typeof t?t(o):t):n}))}),[l]),_=r.useCallback(((e,t)=>{D(e,(e=>({...e,properties:"function"==typeof t?t(e.properties):t})))}),[D]),T=r.useCallback((e=>{u((t=>{const n=new Map(t);for(const o of m){const r=t.get(o);r&&(l(r)&&n.set(o,"function"==typeof e?e(r):e))}return n}))}),[l,m]);return(0,o.jsx)(Z.Provider,{children:e.children,value:{canCreate:s,regions:c,selection:x,transformedRegions:f,transformedSelection:m,canDelete:i,canRead:a,canUpdate:l,create:w,deleteSelection:b,deselect:j,moveSelection:S,render:e.render,selectArea:k,selectId:z,selectPoint:C,setRectX:M,setRectX1:E,setRectX2:R,setRectY:A,setRectY1:N,setRectY2:P,setRegions:u,setSelection:h,updateRegion:D,updateRegionProperties:_,updateSelectedRegions:T}})},SelectionMode:q,Transform:function(e){const t=Q(),n=r.useMemo((()=>{const n=e.fn(t.regions),o=new Set(t.selection).intersection(n);return{...t,transformedRegions:n,transformedSelection:o}}),[t,e.fn]);return(0,o.jsx)(Z.Provider,{children:e.children,value:n})},computeRectInverse:J,selectionMode:function(e){switch(!0){case e.ctrlKey||e.metaKey:return"invert";case e.shiftKey:return"add";case e.altKey:return"subtract";default:return"replace"}},useContext:Q},Symbol.toStringTag,{value:"Module"}));const ne={audioContext:null,buffer:null,fx:{},state:{pause:!0,seek:0,timecode:0},transport:{play:()=>{throw Error("play called outside of context")},stop:()=>{throw Error("stop called outside of context")},seek:()=>{throw Error("seek called outside of context")},getSeek:()=>{throw Error("getSeek called outside of context")}}},oe=r.createContext(ne);function re(){return r.useContext(oe)}function se(){var e,t,n,s;const{audioContext:i,buffer:a,fx:l,state:c,transport:u}=re();return r.useEffect((()=>{if(null==i||null==a)return console.warn("Audio.Effect requires an AudioContext and AudioBuffer");let e=null,t=null,n=null;const o=()=>{l.loop?u.play(l.loop[0]):u.stop(0)},r=()=>{e&&(e.disconnect(),e=null),n&&(n.disconnect(),n=null),t&&(t.disconnect(),t=null)};t=i.createBiquadFilter(),t.type="highpass",t.frequency.value=g(l.hpf??0,0,22050),t.Q.value=20,n=i.createBiquadFilter(),n.type="lowpass",n.frequency.value=g(l.lpf??22050,0,22050),n.Q.value=20,e=i.createBufferSource(),e.buffer=a,e.addEventListener("ended",r),e.addEventListener("ended",o),e.connect(n),n.connect(t),t.connect(i.destination);const s=i.currentTime-c.timecode;if(l.loop){const t=Math.max(0,l.loop[1]-s);e.start(0,s,t)}else e.start(0,s);return()=>{e&&(e.removeEventListener("ended",o),e.removeEventListener("ended",r),e.stop()),r()}}),[i,a,c.timecode,u.play,u.stop,l.hpf,l.lpf,null==(e=l.loop)?void 0:e[0],null==(t=l.loop)?void 0:t[1]]),r.useEffect((()=>{const e=u.getSeek(c);l.loop&&(e<l.loop[0]||e>l.loop[1])&&u.play(l.loop[0])}),[l.loop,null==(n=l.loop)?void 0:n[0],null==(s=l.loop)?void 0:s[1],c,u.getSeek,u.play]),(0,o.jsx)(r.Fragment,{})}const ie=Object.freeze(Object.defineProperty({__proto__:null,Effect:function(){return re().state.pause?(0,o.jsx)(r.Fragment,{}):(0,o.jsx)(se,{})},Provider:function(e){const t=r.useMemo((()=>e.audioContext??new AudioContext),[e.audioContext]),[n,s]=r.useState(ne.state),i=r.useMemo((()=>({play:e=>{s((n=>{const o=e??(n.pause?n.seek:t.currentTime-n.timecode);return{pause:!1,seek:o,timecode:t.currentTime-o}}))},seek:n=>{s((o=>{const r=g("function"==typeof n?n(o.pause?o.seek:t.currentTime-o.timecode):n,0,e.buffer.duration),s=t.currentTime-r;return{...o,seek:r,timecode:s}}))},stop:e=>{s((n=>{const o=e??(n.pause?n.seek:t.currentTime-n.timecode);return{pause:!0,seek:o,timecode:t.currentTime-o}}))},getSeek:e=>e.pause?e.seek:t.currentTime-e.timecode})),[t,e.buffer.duration]);return(0,o.jsx)(oe.Provider,{children:e.children,value:{audioContext:t,buffer:e.buffer,fx:e.fx??ne.fx,state:n,transport:i}})},Seek:function(e){const t=re(),n=r.useRef(null),s=e.format??c.vE;return N(r.useCallback((()=>{n.current&&(n.current.textContent=s(t.transport.getSeek(t.state)))}),[t.transport.getSeek,t.state,s])),(0,o.jsx)("span",{ref:n,children:s(0)})},TransformFx:function(e){const t=r.useContext(oe),n=r.useMemo((()=>({...t,fx:e.fn(t.fx)})),[t,e.fn]);return(0,o.jsx)(oe.Provider,{children:e.children,value:n})},load:function(e){return fetch(e).then((e=>{if(!e.ok)throw Error(`Failed to load audio: ${e.status} ${e.statusText}`);return e.arrayBuffer()})).then((e=>(new AudioContext).decodeAudioData(e)))},useContext:re},Symbol.toStringTag,{value:"Module"}));function ae(e){e.setAttribute("display","none")}function le(e){e.setAttribute("display","inline")}function ce(e,t,n,o){switch(void 0===n&&(n=t),void 0===o&&(o=String),e.constructor){case SVGTextElement:e.setAttribute("x",o(t));break;case SVGLineElement:e.setAttribute("x1",o(t)),e.setAttribute("x2",o(n));break;case SVGRectElement:e.setAttribute("x",o(t)),e.setAttribute("width",o(n))}}function ue(e,t,n,o){switch(void 0===n&&(n=t),void 0===o&&(o=String),e.constructor){case SVGTextElement:e.setAttribute("y",o(t));break;case SVGLineElement:e.setAttribute("y1",o(t)),e.setAttribute("y2",o(n));break;case SVGRectElement:e.setAttribute("y",o(t)),e.setAttribute("height",o(n))}}const de={onKeyUps:{current:new Set},onKeyDowns:{current:new Set}},xe=r.createContext(de);function he(e){const t=r.useRef(new Set),n=r.useRef(new Set);return r.useEffect((()=>{function e(e){for(const t of n.current)t(e)}function o(e){for(const n of t.current)n(e)}return window.addEventListener("keydown",e),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",o)}}),[]),(0,o.jsx)(xe.Provider,{value:{onKeyUps:t,onKeyDowns:n},children:e.children})}function fe(e){const{onKeyUps:t,onKeyDowns:n}=r.useContext(xe);return r.useEffect((()=>{function o(t){e.onKeyDown&&t.key===e.bind&&e.onKeyDown(t)}function r(t){e.onKeyUp&&t.key===e.bind&&e.onKeyUp(t)}return n.current&&n.current.add(o),t.current&&t.current.add(r),()=>{n.current&&n.current.delete(o),t.current&&t.current.delete(r)}}),[e.onKeyDown,e.onKeyUp,e.bind,t,n]),(0,o.jsx)(o.Fragment,{})}const me=5*Math.PI/4,pe=-Math.PI/4;function ve(e){var t;const n=r.useRef(null),{x:s,y:i}=r.useMemo((()=>{const t=me-e.state*(me-pe);return{x:4*Math.cos(t)/5,y:4*-Math.sin(t)/5}}),[e.state]);return _(n,r.useCallback((t=>{let{dy:n,event:o}=t;e.setState(n*(e.direction??1)/(o.ctrlKey||o.metaKey?1e3:100))}),[e.setState,e.direction])),(0,o.jsxs)("svg",{ref:n,width:"60",height:"60",viewBox:"-1.1 -1.1 2.2 2.2",children:[(0,o.jsx)("path",{className:"encoder",d:`\n      M ${Math.cos(me)} ${-Math.sin(me)}\n      A 1 1 0 1 1 ${Math.cos(pe)} ${-Math.sin(pe)}\n    `}),(0,o.jsx)("circle",{className:"encoder-marker",cx:s,cy:i,r:"0.10"}),(0,o.jsx)("text",{className:"encoder-text",textAnchor:"middle",x:"0",y:"0.15",children:(null==(t=e.format)?void 0:t.call(e,e.value))??e.value.toFixed(2)}),e.label&&(0,o.jsx)("text",{className:"encoder-text",textAnchor:"middle",x:"0",y:"0.45",children:1==e.label?e.unit:e.label})]})}function ye(){const e=r.useRef(null),t=re();return N(r.useCallback((()=>{if(e.current&&t.buffer){const n=t.transport.getSeek(t.state);ce(e.current,n/t.buffer.duration),ue(e.current,0,1),le(e.current)}}),[t.buffer,t.state,t.transport.getSeek])),(0,o.jsx)("line",{ref:e,className:"playhead",display:"none",x1:"0",y1:"0",x2:"0",y2:"100%"})}function ge(e){const t=a(),n=Q(),s=r.useRef(null),i=r.useRef(null),l=z(),c=P(t),u=D(s);_(s,t.onWheel);const d=`\n    M 0 0\n    h 1\n    v 1\n    h -1\n    z\n    M ${l.state.scroll.x/l.state.zoom.x} ${l.state.scroll.y/l.state.zoom.y}\n    v ${1/l.state.zoom.y}\n    h ${1/l.state.zoom.x}\n    v ${-1/l.state.zoom.y}\n    z\n  `;return(0,o.jsxs)("svg",{className:"navigator",height:"100%",width:"100%",preserveAspectRatio:"none",viewBox:"0 0 1 1",...c,...e.svgProps,ref:s,children:[(0,o.jsx)("image",{href:e.src,width:"100%",height:"100%",preserveAspectRatio:"none"}),Array.from((e.ignoreRegionTransform?n.regions:n.transformedRegions).values(),(t=>(0,o.jsx)(ee,{children:e.children,dimensions:u,region:t,selected:(e.ignoreRegionTransform?n.selection:n.transformedSelection).has(t.id),viewerId:e.id},t.id))),(0,o.jsx)("path",{ref:i,className:"mask",d:d}),(0,o.jsx)(ye,{})]})}function we(e){const{input:t,mouseup:n,unitUp:s}=v(),i=r.useRef(null),a=r.useRef(null),l=r.useRef(null),u=r.useRef(null),d=R();return N(r.useCallback((()=>{if(i.current&&a.current&&l.current&&u.current&&e.parent.current){const h=i.current;if(t.alt){const i=a.current,f=l.current,m=u.current;let p,v;le(h),e.parent.current==t.focus||d.xaxis==t.xaxis?(p=F(d.xaxis,s.x),ce(i,n.rel.x,void 0,c.KN),le(i)):(p="",ae(i)),e.parent.current==t.focus||d.yaxis==t.yaxis?(v=F(d.yaxis,s.y),ue(f,n.rel.y,void 0,c.KN),le(f)):(v="",ae(f)),function(e,t){e.textContent=t}(m,p&&v?`(${p}, ${v})`:p||v),o=m,r=n.rel,void 0===(x=c.KN)&&(x=String),r.x<.5?(ce(o,r.x,void 0,x),o.setAttribute("text-anchor","start")):(ce(o,r.x,void 0,x),o.setAttribute("text-anchor","end")),r.y<.5?(ue(o,r.y+.01,void 0,x),o.setAttribute("dominant-baseline","hanging")):(ue(o,r.y-.01,void 0,x),o.setAttribute("dominant-baseline","text-top"))}else ae(h)}var o,r,x}),[t,n,d.xaxis,d.yaxis,e.parent,s])),(0,o.jsxs)("g",{ref:i,children:[(0,o.jsx)("line",{ref:a,className:"cursor-x",x1:"0",y1:"0",x2:"0",y2:"100%"}),(0,o.jsx)("line",{ref:l,className:"cursor-y",x1:"0",y1:"0",x2:"100%",y2:"0"}),(0,o.jsx)("text",{ref:u,className:"cursor-text",x:"0",y:"0",children:"0:00"})]})}function be(e){const t=r.useRef(null),n=Q(),s=a(),i=z(),l=D(t),c=P(s);_(t,s.onWheel);const u=`${`translate(${-i.state.scroll.x}, ${-i.state.scroll.y})`} ${`scale(${i.state.zoom.x}, ${i.state.zoom.y})`}`;return(0,o.jsxs)("svg",{className:"visualization",height:"100%",width:"100%",...c,...e.svgProps,ref:t,children:[(0,o.jsx)("defs",{children:(0,o.jsx)("pattern",{id:"dotted-grid",x:"5",y:"5",width:"10",height:"10",patternUnits:"userSpaceOnUse",children:(0,o.jsx)("circle",{cx:"0",cy:"0",r:"1",fill:"black"})})}),(0,o.jsx)("rect",{className:"dotted-grid",width:"100%",height:"100%",fill:"url(#dotted-grid)"}),(0,o.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 1 1",preserveAspectRatio:"none",children:(0,o.jsxs)("g",{transform:u,children:[(0,o.jsx)("image",{preserveAspectRatio:"none",href:e.src,width:"100%",height:"100%"}),Array.from((e.ignoreRegionTransform?n.regions:n.transformedRegions).values(),(t=>(0,o.jsx)(ee,{children:e.children,dimensions:l,region:t,selected:(e.ignoreRegionTransform?n.selection:n.transformedSelection).has(t.id),viewerId:e.id},t.id))),e.showSelection&&(0,o.jsx)(je,{}),(0,o.jsx)(ye,{})]})}),(0,o.jsx)(we,{parent:t})]})}function je(){const e=r.useRef(null),t=v(),n=R();return N(r.useCallback((()=>{var o,r,s;e.current&&(1&t.input.buttons?(le(e.current),o=e.current,r=d(u(t.mousedown.abs,t.mouseup.abs),n.xaxis===t.input.xaxis,n.yaxis===t.input.yaxis),void 0===s&&(s=String),o.setAttribute("x",s(r.x)),o.setAttribute("y",s(r.y)),o.setAttribute("width",s(r.width)),o.setAttribute("height",s(r.height))):ae(e.current))}),[n.xaxis,n.yaxis,t.input,t.mousedown,t.mouseup])),(0,o.jsx)("rect",{ref:e,className:"selection",x:"0",y:"0",width:"0",height:"0"})}ve.X=function(e){const t=X(),n=Q(),r=J(e.region,t);return(0,o.jsx)(ve,{direction:e.direction,format:e.format,label:e.label,setState:t=>n.setRectX(e.region,t),state:r.x,unit:e.region.xunit,value:e.region.x})},ve.X2=function(e){const t=Q(),n=X(),r=J(e.region,n);return(0,o.jsx)(ve,{direction:e.direction,format:e.format,label:e.label,setState:n=>t.setRectX2(e.region,n),state:r.width,unit:e.region.xunit,value:e.region.width})},ve.Y1=function(e){const t=Q(),n=X(),r=J(e.region,n);return(0,o.jsx)(ve,{direction:e.direction,format:e.format,label:e.label,setState:n=>t.setRectY1(e.region,n),state:1-r.y,unit:e.region.yunit,value:e.region.y+e.region.height})},ve.Y2=function(e){const t=Q(),n=X(),r=J(e.region,n);return(0,o.jsx)(ve,{direction:e.direction,format:e.format,label:e.label,setState:n=>t.setRectY2(e.region,n),state:1-r.y-r.height,unit:e.region.yunit,value:e.region.y})}}}]);