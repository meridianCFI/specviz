"use strict";(self.webpackChunk_meridian_cfi_specviz_website=self.webpackChunk_meridian_cfi_specviz_website||[]).push([[645],{5042:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>C,contentTitle:()=>w,default:()=>z,frontMatter:()=>b,metadata:()=>j,toc:()=>S});var o=n(1085),r=n(1184),i=n(3550),s=n(4760),a=n(4041),c=function(e){return e.Whale="\ud83d\udc0b",e.Shark="\ud83e\udd88",e.Pufferfish="\ud83d\udc21",e.Fish="\ud83d\udc20",e}(c||{});function l(e){return(0,o.jsx)(x,{...e,children:(0,o.jsx)(h,{})})}const u=a.createContext(null);function d(){const e=a.useContext(u);if(null==e)throw Error("useContext must be used within a Provider");return e}function x(e){const[t,n]=a.useState(null),[r,s]=a.useState(c.Whale),[l,d]=a.useState(null),x=a.useMemo((()=>({seconds:i._0.time(0,t?.duration??0),hertz:i._0.frequency(2e4,0)})),[t]);return a.useEffect((()=>{i.fP.load(e.audio).then(n)}),[e.audio]),a.useEffect((()=>{fetch(e.annotation).then((e=>e.json())).then((e=>d(new Map(e))))}),[e.annotation]),null==t?"Loading audio...":null==l?"Loading regions...":(0,o.jsx)(u.Provider,{value:{label:r,spectrogram:e.spectrogram,setLabel:s},children:(0,o.jsx)(i.jW,{children:(0,o.jsx)(i.fP.Provider,{buffer:t,children:(0,o.jsx)(i._0.Provider,{value:x,children:(0,o.jsx)(i.pd.K,{children:(0,o.jsx)(i.L7.Provider,{children:e.children,initRegions:l,render:m})})})})})})}function h(){return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",margin:"1.5rem 0"},children:[(0,o.jsx)(p,{}),(0,o.jsx)(f,{}),(0,o.jsx)(y,{}),(0,o.jsx)(i.fP.Effect,{})]})}function p(){const e=d(),t=i.fP.useContext(),n=i.L7.useContext(),r=i.LM.useContext(),s=a.useCallback((t=>{let{unit:o,rel:r,abs:i,xaxis:s,yaxis:a,event:c}=t;0==n.selection.size&&n.create({...o,id:crypto.randomUUID(),xunit:s.unit,yunit:a.unit,properties:{label:e.label}})}),[e.label,n.create,n.selection]),c=a.useCallback((e=>{let{unit:t,rel:o,abs:r,xaxis:s,yaxis:a,event:c}=e;n.selectPoint(r,i.L7.selectionMode(c))}),[n.selectPoint]),l=a.useCallback((e=>{let{dx:t,dy:o,event:i}=e;n.selection.size>0&&n.moveSelection(t/r.state.zoom.x,o/r.state.zoom.y)}),[n.moveSelection,n.selection,r.state.zoom]),u=a.useCallback((e=>{let{unit:n,rel:o,abs:r,xaxis:i,yaxis:s,event:a}=e;t.transport.seek(n.x)}),[t.transport.seek]);return(0,o.jsx)("div",{style:{backgroundColor:"cornsilk",border:"1px solid burlywood",display:"grid",gridGap:"1rem",gridTemplateColumns:"80px 1fr",gridTemplateRows:"400px 20px",gridTemplateAreas:'\n          "y spec"\n          ". x"\n        ',padding:"1rem"},children:(0,o.jsxs)(i.Zc.K,{xaxis:"seconds",yaxis:"hertz",children:[(0,o.jsx)("div",{style:{gridArea:"x",overflow:"hidden"},children:(0,o.jsx)(i._0.Horizontal,{})}),(0,o.jsx)("div",{style:{gridArea:"y",overflow:"hidden"},children:(0,o.jsx)(i._0.Vertical,{})}),(0,o.jsx)("div",{style:{gridArea:"spec"},children:(0,o.jsx)(i.rc.K,{onClick:c,onContextMenu:u,onDrag:l,onRect:s,children:(0,o.jsx)(i.Di,{showSelection:0==n.selection.size,src:e.spectrogram})})})]})})}function f(){const e=d(),t=i.fP.useContext(),n=i.L7.useContext();return(0,o.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,o.jsx)(g,{children:"<<",onClick:()=>t.transport.seek((e=>e-5)),title:"z"}),t.state.pause?(0,o.jsx)(g,{children:"Play",onClick:()=>t.transport.play(),title:"x"}):(0,o.jsx)(g,{children:"Stop",onClick:()=>t.transport.stop(),title:"x"}),(0,o.jsx)(g,{children:">>",onClick:()=>t.transport.seek((e=>e+5)),title:"c"}),(0,o.jsx)("div",{style:{flexGrow:1}}),(0,o.jsx)(g,{children:"Clear Selection",disabled:0==n.selection.size,onClick:()=>n.setSelection(new Set),title:"Escape"}),(0,o.jsx)(g,{children:"Delete",disabled:0==n.selection.size,onClick:()=>n.deleteSelection(),title:"Backspace"}),(0,o.jsx)("div",{style:{flexGrow:1}}),Object.values(c).map(((t,n)=>(0,o.jsx)(g,{children:t,onClick:()=>e.setLabel(t),style:{fontSize:"1.5rem",borderColor:e.label==t?"orchid":void 0},title:String(n+1)},t)))]})}function m(e){return(0,o.jsxs)("svg",{...e.svgProps,cursor:"pointer",children:[(0,o.jsx)("rect",{width:"100%",height:"100%",fill:e.selected?"chartreuse":"violet",fillOpacity:"0.7",style:{mixBlendMode:"hue"}}),(0,o.jsx)("text",{x:"8",y:"8",children:e.region.properties?.label??"\ud83e\udd37\ud83c\udffd",fontSize:"30"})]})}function y(){const e=i.L7.useContext();return(0,o.jsxs)("table",{style:{backgroundColor:"lavenderblush",border:"1px solid thistle",maxHeight:"400px",overflow:"auto",padding:"1rem"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{style:{textAlign:"left"},children:[(0,o.jsx)("th",{}),(0,o.jsx)("th",{children:"Id"}),(0,o.jsx)("th",{children:"Label"}),(0,o.jsx)("th",{children:"Hz (min)"}),(0,o.jsx)("th",{children:"Hz (max)"}),(0,o.jsx)("th",{children:"Duration"})]})}),(0,o.jsx)("tbody",{children:Array.from(e.regions.values(),(t=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"checkbox",checked:e.selection.has(t.id),onChange:n=>e.setSelection((e=>{const o=new Set(e);return n.target.checked?o.add(t.id):o.delete(t.id),o}))})}),(0,o.jsx)("td",{children:t.id}),(0,o.jsx)("td",{children:(0,o.jsxs)("select",{value:t.properties?.label??"\ud83e\udd37\ud83c\udffd",onChange:n=>e.updateRegionProperties(t.id,(e=>({...e,label:n.target.value}))),style:{fontSize:"1rem"},children:[(0,o.jsx)("option",{value:"\ud83e\udd37\ud83c\udffd",children:"\ud83e\udd37\ud83c\udffd"}),Object.values(c).map((e=>(0,o.jsx)("option",{value:e,children:e},e)))]})}),(0,o.jsx)("td",{children:s.hz(t.y)}),(0,o.jsx)("td",{children:s.hz(t.y+t.height)}),(0,o.jsx)("td",{children:s.vE(t.width)})]},t.id)))})]})}function g(e){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{...e,title:e.title?.toUpperCase(),type:"button"}),e.title&&e.onClick&&(0,o.jsx)(i.DA,{bind:e.title,onKeyDown:e.onClick})]})}var v=n(9359);const b={sidebar_position:3,tags:["action","audio","axis","input","note"]},w="Basic Annotation",j={id:"examples/basic-annotation",title:"Basic Annotation",description:"Add annotation capability to your application. Please read Basic Spectrogram and Basic Audio before continuing.",source:"@site/docs/examples/basic-annotation.mdx",sourceDirName:"examples",slug:"/examples/basic-annotation",permalink:"/specviz/docs/examples/basic-annotation",draft:!1,unlisted:!1,tags:[{inline:!0,label:"action",permalink:"/specviz/docs/tags/action"},{inline:!0,label:"audio",permalink:"/specviz/docs/tags/audio"},{inline:!0,label:"axis",permalink:"/specviz/docs/tags/axis"},{inline:!0,label:"input",permalink:"/specviz/docs/tags/input"},{inline:!0,label:"note",permalink:"/specviz/docs/tags/note"}],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,tags:["action","audio","axis","input","note"]},sidebar:"mainSidebar",previous:{title:"Basic Audio",permalink:"/specviz/docs/examples/basic-audio"},next:{title:"Interactive Spectrogram",permalink:"/specviz/docs/examples/interactive-spectrogram"}},C={},S=[{value:"Your App, Your Data",id:"your-app-your-data",level:3},{value:"Context Provider",id:"context-provider",level:3},{value:"Basic Controls",id:"basic-controls",level:3},{value:"Specviz.Action",id:"specvizaction",level:3},{value:"Specviz.Note.useContext",id:"specviznoteusecontext",level:3}];function k(e){const t={a:"a",code:"code",div:"div",h1:"h1",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"basic-annotation",children:"Basic Annotation"})}),"\n",(0,o.jsxs)(t.p,{children:["Add annotation capability to your application. Please read ",(0,o.jsx)(t.a,{href:"/specviz/docs/examples/basic-spectrogram",children:"Basic Spectrogram"})," and ",(0,o.jsx)(t.a,{href:"/specviz/docs/examples/basic-audio",children:"Basic Audio"})," before continuing."]}),"\n","\n",(0,o.jsx)(v.A,{fallback:(0,o.jsx)(t.div,{children:"Loading..."}),children:e=>(0,o.jsx)(l,{audio:e("/audio.flac"),spectrogram:e("/spectrogram.png"),annotation:e("/example-basic-annotation.json")})}),"\n",(0,o.jsx)(t.h3,{id:"your-app-your-data",children:"Your App, Your Data"}),"\n",(0,o.jsxs)(t.p,{children:["Specviz is 100% type-safe and extends this safety even to your application's domain-specific data. TypeScript is ",(0,o.jsx)(t.strong,{children:"not required"})," but it is highly recommended. Start by defining the type for your user data."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'type UserData = {\n  label?: Label\n}\n\nenum Label {\n  Whale = "\ud83d\udc0b",\n  Shark = "\ud83e\udd88",\n  Pufferfish = "\ud83d\udc21",\n  Fish = "\ud83d\udc20",\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Specviz makes no assumptions about your application's data. To render your annotations, you will need to write a React component. Here we use ",(0,o.jsx)(t.code,{children:"Specviz.Note.AnnotationProps<T>"})," with our ",(0,o.jsx)(t.code,{children:"UserData"})," to type our component. Use the provided default properties in ",(0,o.jsx)(t.code,{children:"props.svgProps"})," and supply any other text, shapes, or styles as needed."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'function MyAnnotation(props: Specviz.Note.AnnotationProps<UserData>) {\n  return (\n    <svg {...props.svgProps} cursor="pointer">\n      <rect\n        fill={props.selected ? "chartreuse" : "violet"}\n        fillOpacity="0.7"\n        style={{ mixBlendMode: "hue" }}\n      />\n      <text\n        x="8"\n        y="8"\n        children={props.region.properties?.label ?? "\ud83e\udd37\ud83c\udffd"}\n        fontSize="30"\n      />\n    </svg>\n  )\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"context-provider",children:"Context Provider"}),"\n",(0,o.jsx)(t.p,{children:"Next we will setup a basic context for our application's custom data. This is React Context 101."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'type Context = {\n  label: Label\n  setLabel: (label: Label) => void\n}\n\nconst defaultContext: Context = {\n  label: Label.Whale,\n  setLabel: () => {\n    throw Error("setLabel not implemented")\n  },\n}\n\nconst Context = React.createContext(defaultContext)\n'})}),"\n",(0,o.jsxs)(t.p,{children:["In your application's provider, use ",(0,o.jsx)(t.code,{children:"Specviz.Note.Provider"})," to supply the initial regions and annotation component to you application. Use ",(0,o.jsx)(t.code,{children:"Specviz.Note.RegionState<T>"})," with your ",(0,o.jsx)(t.code,{children:"UserData"})," to type your regions."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'function AppProvider(props: { children: React.ReactNode }) {\n  const [label, setLabel] = React.useState(defaultContext.label)\n  const [regions, setRegions] =\n    React.useState<null | Specviz.Note.RegionState<UserData>>(null)\n  React.useEffect(() => {\n    fetch("./example-basic-annotation.json")\n      .then(r => r.json())\n      .then(entries => setRegions(new Map(entries)))\n  }, [])\n  if (regions == null) return "Loading regions..."\n  return (\n    <Context.Provider value={{ label, setLabel }}>\n      <...>\n        <Specviz.Note.Provider\n          initRegions={regions}\n          render={MyAnnotation}\n        >\n          {props.children}\n        </Specviz.Note.Provider>\n      </...>\n    </Context.Provider>\n  )\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"basic-controls",children:"Basic Controls"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"Specviz.Note"})," and ",(0,o.jsx)(t.code,{children:"Specviz.Audio"})," contain many useful functions. You can create your own buttons to bind them in whatever way will be useful for your application."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'function NoteControls() {\n  const app = React.useContext(Context)\n  const note = Specviz.Note.useContext()\n  return (\n    <>\n      <button\n        children="Clear Selection"\n        disabled={note.selection.size == 0}\n        onClick={() => note.setSelection(new Set())}\n      />\n      <button\n        children="Delete"\n        disabled={note.selection.size == 0}\n        onClick={() => note.deleteSelection()}\n      />\n    </>\n  )\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Here we use ",(0,o.jsx)(t.code,{children:"audio.state"})," to conditionally display a ",(0,o.jsx)(t.strong,{children:"Play"})," or ",(0,o.jsx)(t.strong,{children:"Stop"})," button."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'function AudioControls() {\n  const app = React.useContext(Context)\n  const audio = Specviz.Audio.useContext()\n  return (\n    <>\n      <button\n        children="Rewind 5s"\n        onClick={() => audio.transport.seek(t => t - 5)}\n        title="z"\n      />\n      {audio.state.pause ? (\n        <button\n          children="Play"\n          onClick={() => audio.transport.play()}\n          title="x"\n        />\n      ) : (\n        <button\n          children="Stop"\n          onClick={() => audio.transport.stop()}\n          title="x"\n        />\n      )}\n      <button\n        children="Forward 5s"\n        onClick={() => audio.transport.seek(t => t + 5)}\n        title="c"\n      />\n    </>\n  )\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"specvizaction",children:"Specviz.Action"}),"\n",(0,o.jsx)(t.p,{children:"Specviz does not include default behaviors or keyboard shortcuts. Instead, your application will decide what tools are needed, and when they trigger a particular Specviz action."}),"\n",(0,o.jsxs)(t.p,{children:["We will expand our ",(0,o.jsx)(t.code,{children:"Visualizer"})," used in ",(0,o.jsx)(t.a,{href:"/specviz/docs/examples/basic-audio",children:"Basic Audio"})," to add ",(0,o.jsx)(t.strong,{children:"annotate"}),", ",(0,o.jsx)(t.strong,{children:"select"}),", ",(0,o.jsx)(t.strong,{children:"move"})," and ",(0,o.jsx)(t.strong,{children:"seek"}),". actions. In general, use ",(0,o.jsx)(t.code,{children:"Specviz.Action.Provider"})," to assign your actions to Specviz components."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:"function Visualizer() {\n  ...\n  return (\n    <...>\n      <Specviz.Action.Provider\n        onClick={select}\n        onContextMenu={seek}\n        onDrag={move}\n        onRect={annotate}\n      >\n        <Specviz.Visualization .../>\n      </Specviz.Action.Provider>\n    </...>\n  )\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Let's start writing our ",(0,o.jsx)(t.code,{children:"select"}),", ",(0,o.jsx)(t.code,{children:"move"})," and ",(0,o.jsx)(t.code,{children:"seek"})," actions now."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'function Visualizer() {\n  const audio = Specviz.Audio.useContext()\n  const note = Specviz.Note.useContext()\n  const viewport = Specviz.Viewport.useContext()\n  \n  const select: Specviz.Action.Handler["onClick"] = React.useCallback(\n    ({ unit, rel, abs, xaxis, yaxis, event }) => {\n      note.selectPoint(abs, Specviz.Note.selectionMode(event))\n    },\n    [note.selectPoint],\n  )\n\n  const move: Specviz.Action.Handler["onDrag"] = React.useCallback(\n    ({ dx, dy, event }) => {\n      if (note.selection.size > 0)\n        note.moveSelection(\n          dx / viewport.state.zoom.x,\n          dy / viewport.state.zoom.y,\n        )\n    },\n    [note.moveSelection, note.selection, viewport.state.zoom],\n  )\n\n  const seek: Specviz.Action.Handler["onContextMenu"] = React.useCallback(\n    ({ unit, rel, abs, xaxis, yaxis, event }) => {\n      audio.transport.seek(unit.x)\n    },\n    [audio.transport.seek],\n  )\n  ...\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["To write the ",(0,o.jsx)(t.code,{children:"annotate"})," action, we will insert our custom ",(0,o.jsx)(t.code,{children:"label"})," found in our application context. The annotation's required ",(0,o.jsx)(t.code,{children:"id"})," field can be generated using any generator or sequence."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'function Visualizer() {\n  const app = React.useContext(Context)\n  const note = Specviz.Note.useContext()\n  ...\n  const annotate: Specviz.Action.Handler["onRect"] = React.useCallback(\n    ({ unit, rel, abs, xaxis, yaxis, event }) => {\n      if (note.selection.size == 0)\n        note.create({\n          ...unit,\n          id: crypto.randomUUID(),\n          xunit: xaxis.unit,\n          yunit: yaxis.unit,\n          properties: { label: app.label },\n        })\n    },\n    [app.label, note.create, note.selection],\n  )\n  ...\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"specviznoteusecontext",children:"Specviz.Note.useContext"}),"\n",(0,o.jsxs)(t.p,{children:["Use ",(0,o.jsx)(t.code,{children:"Specviz.Note.useContext<T>"})," with your ",(0,o.jsx)(t.code,{children:"UserData"})," to access your note context."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:"function AnnotationTable() {\n  const note = Specviz.Note.useContext<UserData>()\n  return (\n    <table>\n      <thead>\n        <tr>\n          <th />\n          <th>Id</th>\n          <th>Label</th>\n          <th>Hz (min)</th>\n          <th>Hz (max)</th>\n          <th>Duration</th>\n        </tr>\n      </thead>\n      <tbody>\n        {Array.from(note.regions.values(), region => (\n          ...\n        ))}\n      </tbody>\n    </table>\n  )\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Use other functions like ",(0,o.jsx)(t.code,{children:"note.setSelection"})," and ",(0,o.jsx)(t.code,{children:"note.updateRegionProperties"})," to complete the table."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",metastring:'title="./App.tsx"',children:'function AnnotationTable() {\n  const note = Specviz.Note.useContext<UserData>()\n  return (\n    <table>\n      <thead>...</thead>\n      <tbody>\n        {Array.from(note.regions.values(), region => (\n          <tr key={region.id}>\n            <td>\n              <input\n                type="checkbox"\n                checked={note.selection.has(region.id)}\n                onChange={event =>\n                  note.setSelection(prev => {\n                    const next = new Set(prev)\n                    if (event.target.checked) next.add(region.id)\n                    else next.delete(region.id)\n                    return next\n                  })\n                }\n              />\n            </td>\n            <td>{region.id}</td>\n            <td>\n              <select\n                value={region.properties?.label ?? "\ud83e\udd37\ud83c\udffd"}\n                onChange={event =>\n                  note.updateRegionProperties(region.id, p => ({\n                    ...p,\n                    label: event.target.value as Label,\n                  }))\n                }\n                style={{ fontSize: "1rem" }}\n              >\n                <option value="\ud83e\udd37\ud83c\udffd" children="\ud83e\udd37\ud83c\udffd" />\n                {Object.values(Label).map(label => (\n                  <option key={label} value={label} children={label} />\n                ))}\n              </select>\n            </td>\n            <td>{Format.hz(region.y)}</td>\n            <td>{Format.hz(region.y + region.height)}</td>\n            <td>{Format.timestamp(region.width)}</td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  )\n'})})]})}function z(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(k,{...e})}):k(e)}},4760:(e,t,n)=>{function o(e){return e<1e3?e.toFixed(0)+" Hz":(e/1e3).toFixed(3)+" kHz"}function r(e){return(100*e).toFixed(3)+"%"}function i(e){const t=Math.floor(e/60);return`${t}:${(e-t).toFixed(3).padStart(2,"0")}`}function s(e){const t=new Uint8Array(e);return window.crypto.getRandomValues(t),Array.from(t,(e=>e.toString(16).padStart(2,"0"))).join("")}n.d(t,{KN:()=>r,hz:()=>o,po:()=>s,vE:()=>i})},3550:(e,t,n)=>{n.d(t,{rc:()=>o,fP:()=>l,_0:()=>a,jW:()=>je,Nz:()=>ve,pd:()=>r,DA:()=>Ce,mD:()=>$e,L7:()=>c,Zc:()=>i,LM:()=>s,Di:()=>Ke});var o={};n.r(o),n.d(o,{K:()=>p,N:()=>f});var r={};n.r(r),n.d(r,{K:()=>j,N:()=>C});var i={};n.r(i),n.d(i,{K:()=>A,N:()=>M});var s={};n.r(s),n.d(s,{Provider:()=>L,Transform:()=>I,ZoomDirection:()=>N,useContext:()=>U});var a={};n.r(a),n.d(a,{Horizontal:()=>ee,Provider:()=>re,Vertical:()=>te,computeRect:()=>H,computeRectInverse:()=>X,computeUnit:()=>Y,computeUnitInverse:()=>V,formatUnit:()=>W,frequency:()=>Q,linear:()=>q,nonlinear:()=>O,percent:()=>J,time:()=>Z,useContext:()=>ie});var c={};n.r(c),n.d(c,{Annotation:()=>fe,Provider:()=>ue,SelectionMode:()=>se,Transform:()=>pe,computeRectInverse:()=>xe,selectionMode:()=>he,useContext:()=>de});var l={};n.r(l),n.d(l,{Effect:()=>Ne,Provider:()=>Ae,Seek:()=>Ee,TransformFx:()=>Re,load:()=>Se,useContext:()=>Me});var u=n(4041),d=n(1085);const x={},h=u.createContext(x);function p(e){const t=u.useContext(h),n=u.useMemo((()=>({...t,...e})),[t,e]);return(0,d.jsx)(h.Provider,{children:e.children,value:n})}function f(){return u.useContext(h)}var m=n(4760);function y(e,t,n,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=0);let r=e,i=t,s=n,a=o;return{abs:{get x(){return r},set x(e){r=e},get y(){return i},set y(e){i=e}},rel:{get x(){return s},set x(e){s=e},get y(){return a},set y(e){a=e}}}}const g={x:0,y:0};function v(e,t){void 0===e&&(e=0),void 0===t&&(t=0);let n=e,o=t;return{get x(){return n},get y(){return o},set x(e){n=e},set y(e){o=e}}}const b={input:{alt:!1,buttons:0,focus:null,xaxis:null,yaxis:null},mousedown:{abs:g,rel:g},mouseup:{abs:g,rel:g},unitDown:g,unitUp:g},w=u.createContext(b);function j(e){const t=u.useMemo((()=>{let e=0,t=!1,n=null,o=null,r=null;return{get buttons(){return e},set buttons(t){e=t},get alt(){return t},set alt(e){t=e},get focus(){return n},set focus(e){n=e},get xaxis(){return o},set xaxis(e){o=e},get yaxis(){return r},set yaxis(e){r=e}}}),[]),n=u.useMemo(y,[]),o=u.useMemo(y,[]),r=u.useMemo(v,[]),i=u.useMemo(v,[]),s={input:t,mousedown:n,mouseup:o,unitDown:r,unitUp:i};return u.useEffect((()=>{function e(e){"Alt"==e.key&&(t.alt=!0)}function n(e){"Alt"==e.key&&(t.alt=!1)}return window.addEventListener("keydown",e),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",n)}}),[t]),(0,d.jsx)(w.Provider,{children:e.children,value:s})}function C(){return u.useContext(w)}function S(e,t,n){return Math.min(Math.max(e,t),n)}const k={xaxis:q(0,100,"x"),yaxis:q(0,100,"y")},z=u.createContext(k);function A(e){const t=ie(),n=t[e.xaxis],o=t[e.yaxis];if(null==n)throw Error(`axis not found: ${e.xaxis}`);if(null==o)throw Error(`axis not found: ${e.yaxis}`);return(0,d.jsx)(z.Provider,{children:e.children,value:{xaxis:n,yaxis:o}})}function M(){return u.useContext(z)}function R(e,t){return{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),width:Math.abs(t.x-e.x),height:Math.abs(t.y-e.y)}}function E(e,t,n){return{x:t?e.x:0,y:n?e.y:0,width:t?e.width:1,height:n?e.height:1}}let N=function(e){return e[e.out=0]="out",e[e.in=1]="in",e}({});const P={state:{scroll:{x:0,y:0},zoom:{x:1,y:1}},resetView:()=>{throw Error("resetView called outside of context")},scroll:()=>{throw Error("scroll called outside of context")},scrollTo:()=>{throw Error("scrollTo called outside of context")},zoom:()=>{throw Error("zoom called outside of context")},zoomArea:()=>{throw Error("zoomArea called outside of context")},zoomPoint:()=>{throw Error("zoomPoint called outside of context")},zoomScroll:()=>{throw Error("zoomScroll called outside of context")}},D={x:10,y:10},T=u.createContext(P);function L(e){const t=C(),[n,o]=u.useState(P.state),r=u.useCallback((()=>{o(P.state)}),[]),i=u.useCallback(((e,t)=>{o((n=>({...n,scroll:{x:S(n.scroll.x+e,0,n.zoom.x-1),y:S(n.scroll.y+t,0,n.zoom.y-1)}})))}),[]),s=u.useCallback((e=>{o((t=>({...t,scroll:{x:S(e.x,0,t.zoom.x-1),y:S(e.y,0,t.zoom.y-1)}})))}),[]),a=u.useCallback(((e,t)=>{o((n=>({...n,zoom:{x:S(n.zoom.x+e,1,D.x),y:S(n.zoom.y+t,1,D.y)}})))}),[]),c=u.useCallback((e=>{o((t=>{const n=S(1/e.width,1,D.x),o=S(1/e.height,1,D.y);return{zoom:{x:n,y:o},scroll:{x:S((e.x+e.width/2)*n-.5,0,n-1),y:S((e.y+e.height/2)*o-.5,0,o-1)}}}))}),[]),l=u.useCallback(((e,t)=>{o((n=>{const o=t==N.out?-.5:.5,r=e.x*n.zoom.x-n.scroll.x,i=e.y*n.zoom.y-n.scroll.y,s=S(n.zoom.x+o,1,D.x),a=S(n.zoom.y+o,1,D.y);return{zoom:{x:s,y:a},scroll:{x:S(e.x*s-r,0,s-1),y:S(e.y*a-i,0,a-1)}}}))}),[]),x=u.useCallback(((e,n)=>{o((o=>{const r=S(o.zoom.x+e,1,D.x),i=S(o.zoom.y+n,1,D.y);return{zoom:{x:r,y:i},scroll:{x:S(t.mousedown.abs.x*r-t.mousedown.rel.x,0,r-1),y:S(t.mousedown.abs.y*i-t.mousedown.rel.y,0,i-1)}}}))}),[t.mousedown.abs,t.mousedown.rel]),h=u.useMemo((()=>({resetView:r,scroll:i,scrollTo:s,state:n,zoom:a,zoomArea:c,zoomPoint:l,zoomScroll:x})),[r,i,s,n,a,c,l,x]);return(0,d.jsx)(T.Provider,{children:e.children,value:h})}function U(){return u.useContext(T)}function I(e){const t=U(),n=u.useMemo((()=>{const n=e.fn(t.state);return{...t,state:n}}),[t,e.fn]);return(0,d.jsx)(T.Provider,{children:e.children,value:n})}function $(e){u.useEffect((()=>{let t;return t=window.requestAnimationFrame((function n(o){e(o),t=window.requestAnimationFrame(n)})),()=>{window.cancelAnimationFrame(t)}}),[e])}function F(e){const t=C(),n=M();return function(e){const t=M(),n=C(),o=U(),r=u.useCallback((t=>{t.preventDefault(),e.onContextMenu?.(t)}),[e.onContextMenu]),i=u.useCallback((t=>{t.preventDefault(),n.input.buttons=t.buttons,e.onMouseDown?.(t)}),[n.input,e.onMouseDown]),s=u.useCallback((r=>{const i=r.currentTarget.getBoundingClientRect(),s=(r.clientX-i.x)/i.width,a=(r.clientY-i.y)/i.height;1&n.input.buttons?(n.mouseup.rel.x=s,n.mouseup.rel.y=a,n.mouseup.abs.x=(s+o.state.scroll.x)/o.state.zoom.x,n.mouseup.abs.y=(a+o.state.scroll.y)/o.state.zoom.y,n.unitUp.x=Y(t.xaxis,S(n.mouseup.abs.x,0,1)),n.unitUp.y=Y(t.yaxis,S(n.mouseup.abs.y,0,1))):(n.mousedown.rel.x=n.mouseup.rel.x=s,n.mousedown.rel.y=n.mouseup.rel.y=a,n.mousedown.abs.x=n.mouseup.abs.x=(s+o.state.scroll.x)/o.state.zoom.x,n.mousedown.abs.y=n.mouseup.abs.y=(a+o.state.scroll.y)/o.state.zoom.y,n.unitDown.x=n.unitUp.x=Y(t.xaxis,S(n.mousedown.abs.x,0,1)),n.unitDown.y=n.unitUp.y=Y(t.yaxis,S(n.mousedown.abs.y,0,1))),e.onMouseMove?.(r)}),[n.input,n.mousedown,n.mouseup,t.xaxis,t.yaxis,e.onMouseMove,n.unitDown,n.unitUp,o.state.scroll.x,o.state.scroll.y,o.state.zoom.x,o.state.zoom.y]),a=u.useCallback((t=>{e.onMouseUp?.(t),n.input.buttons=0}),[n.input,e.onMouseUp]),c=u.useCallback((o=>{n.input.focus=o.currentTarget,null!=t.xaxis&&(n.input.xaxis=t.xaxis),null!=t.yaxis&&(n.input.yaxis=t.yaxis),e.onMouseEnter?.(o)}),[n.input,t.xaxis,t.yaxis,e.onMouseEnter]),l=u.useCallback((t=>{e.onMouseLeave?.(t),n.input.buttons=0,n.input.focus=null,n.input.xaxis=null,n.input.yaxis=null}),[n.input,e.onMouseLeave]);return u.useMemo((()=>({onContextMenu:r,onMouseDown:i,onMouseMove:s,onMouseUp:a,onMouseEnter:c,onMouseLeave:l})),[r,i,s,a,c,l])}({onMouseMove:u.useCallback((n=>{if(1&t.input.buttons){const t=n.movementX/n.currentTarget.clientWidth,o=n.movementY/n.currentTarget.clientHeight;e.onDrag?.({dx:t,dy:o,event:n})}}),[t.input,e.onDrag]),onMouseUp:u.useCallback((o=>{if(1&t.input.buttons){const i=R(t.mousedown.abs,t.mouseup.abs);r=i,Math.sqrt(r.width**2+r.height**2)<.01?e.onClick?.({event:o,unit:t.unitUp,rel:t.mouseup.rel,abs:t.mouseup.abs,xaxis:n.xaxis,yaxis:n.yaxis}):e.onRect?.({event:o,unit:R(t.unitDown,t.unitUp),rel:R(t.mousedown.rel,t.mouseup.rel),abs:i,xaxis:n.xaxis,yaxis:n.yaxis})}else 2&t.input.buttons&&e.onContextMenu?.({event:o,unit:t.unitUp,rel:t.mouseup.rel,abs:t.mouseup.abs,xaxis:n.xaxis,yaxis:n.yaxis});var r}),[t.input,t.mousedown,t.mouseup,t.unitDown,t.unitUp,n.xaxis,n.yaxis,e.onClick,e.onContextMenu,e.onRect])})}function K(e){const[t,n]=u.useState(g),o=u.useMemo((()=>new ResizeObserver((e=>{for(const t of e)for(const{blockSize:e,inlineSize:o}of t.borderBoxSize)n((t=>t.x===o&&t.y===e?t:{x:o,y:e}))}))),[]);return u.useLayoutEffect((()=>(e.current&&o.observe(e.current),()=>{o.disconnect()})),[o,e]),t}function B(e,t){const n=u.useCallback((n=>{if(e.current){n.preventDefault();const o=n.deltaX/e.current.clientWidth,r=n.deltaY/e.current.clientHeight;t?.({dx:o,dy:r,event:n})}}),[t,e]);u.useEffect((()=>(e.current&&e.current.addEventListener("wheel",n,{passive:!1}),()=>{e.current&&e.current.removeEventListener("wheel",n)})),[e,n])}function Y(e,t){if(null==e)return Number.NEGATIVE_INFINITY;const{intervals:n}=e;if(n.length<2)return Number.NEGATIVE_INFINITY;let o,r,i,s,a=0;for(;a<n.length-1;){if([o,r]=n[a],[i,s]=n[a+1],o<=t&&t<=i)return r+(s-r)*(t-o)/(i-o);a+=1}return Number.NEGATIVE_INFINITY}function V(e,t){if(null==e)return Number.NEGATIVE_INFINITY;const n=[...e.intervals].sort(((e,t)=>{let[n,o]=e,[r,i]=t;return o-i}));if(n.length<2)return Number.NEGATIVE_INFINITY;let o,r,i,s,a=0;for(;a<n.length-1;){if([o,r]=n[a],[i,s]=n[a+1],r<=t&&t<=s)return o+(i-o)*(t-r)/(s-r);a+=1}return Number.NEGATIVE_INFINITY}function _(e){return(t,n,o)=>{const r=e(t,o.x),i=e(n,o.y);return s={x:r,y:i,width:e(t,o.x+o.width)-r,height:e(n,o.y+o.height)-i},{x:Math.min(s.x,s.x+s.width),y:Math.min(s.y,s.y+s.height),width:Math.abs(s.width),height:Math.abs(s.height)};var s}}const H=_(Y),X=_(V);function G(e,t){const n=[];if(t<=0)return n;const o=e.intervals.at(0),r=e.intervals.at(-1);if(null==o||null==r)return n;const[i,s]=o[1]<r[1]?[o[1],r[1]]:[r[1],o[1]],a=Math.abs(s-i),c=Math.log10(a/t),l=Math.floor(c),u=c-l<=.69?5*10**l:1*10**(l+1);for(let d=i;d<s;d+=u)n.push([V(e,d),d]);return n}function W(e,t){return e.format(t)}function q(e,t,n,o){return{unit:n??"units",format:o??String,intervals:[[0,e],[1,t]]}}function O(e,t,n){return{unit:t??"units",format:n??String,intervals:e}}function Z(e,t,n,o){return void 0===n&&(n="seconds"),void 0===o&&(o=m.vE),q(e,t,n,o)}function Q(e,t,n,o){return void 0===n&&(n="hertz"),void 0===o&&(o=m.hz),q(e,t,n,o)}function J(e,t,n,o){return void 0===n&&(n="percent"),void 0===o&&(o=m.KN),q(e,t,n,o)}function ee(e){const t=u.useRef(null),n=M(),o=K(t),r=f(),i=U();B(t,r.onWheel);const s=e.tickWidth??80,a=e.tickHeight??20,c=o.x*i.state.zoom.x,l=1*o.y,x=c/s,h=`0 0 ${c/Math.max(1,x)} ${a}`,p=u.useMemo((()=>Array.from(G(n.xaxis,x),(e=>{let[t,o]=e;return(0,d.jsxs)("svg",{className:"axis-tick axis-tick-x",x:String(t),y:1-a/l,width:String(1/x),height:String(a/l),viewBox:h,preserveAspectRatio:"none",children:[(0,d.jsx)("line",{x1:"1",y1:"0",x2:"1",y2:String(a)}),(0,d.jsx)("text",{x:"5",y:"5",children:W(n.xaxis,o)})]},o)}))),[l,Math.floor(x),n.xaxis,h,a]),m=`${`translate(${-i.state.scroll.x}, 0)`} ${`scale(${i.state.zoom.x}, 1)`}`;return(0,d.jsx)("svg",{ref:t,width:"100%",height:"100%",viewBox:"0 0 1 1",preserveAspectRatio:"none",overflow:"visible",children:(0,d.jsx)("g",{transform:m,children:p})})}function te(e){const t=u.useRef(null),n=M(),o=K(t),r=f(),i=U();B(t,r.onWheel);const s=e.tickWidth??80,a=e.tickHeight??20,c=1*o.x,l=o.y*i.state.zoom.y,x=l/a,h=`0 0 ${s} ${l/Math.max(1,x)}`,p=u.useMemo((()=>Array.from(G(n.yaxis,x),(e=>{let[t,o]=e;return(0,d.jsxs)("svg",{className:"axis-tick axis-tick-y",x:String(0),y:String(t),width:String(s/c),height:String(1/x),viewBox:h,preserveAspectRatio:"none",children:[(0,d.jsx)("line",{x1:String(.9*s),y1:"0",x2:String(s),y2:"0"}),(0,d.jsx)("text",{x:"5",y:"0",children:W(n.yaxis,o)})]},o)}))),[Math.floor(x),n.yaxis,h,c,s]),m=`${`translate(0, ${-i.state.scroll.y})`} ${`scale(1, ${i.state.zoom.y})`}`;return(0,d.jsx)("svg",{ref:t,width:"100%",height:"100%",viewBox:"0 0 1 1",preserveAspectRatio:"none",overflow:"visible",children:(0,d.jsx)("g",{transform:m,children:p})})}const ne={},oe=u.createContext(ne),re=oe.Provider;function ie(){return u.useContext(oe)}let se=function(e){return e.add="add",e.invert="invert",e.replace="replace",e.subtract="subtract",e}({});function ae(e,t,n){switch(n){case se.invert:return e.symmetricDifference(t);case se.add:return e.union(t);case se.subtract:return e.difference(t);case se.replace:return t}}const ce={canCreate:!0,regions:new Map,selection:new Set,transformedRegions:new Map,transformedSelection:new Set,create(){throw Error("annotate called outside of context")},canDelete:()=>!0,canRead:()=>!0,canUpdate:()=>!0,deleteSelection(){throw Error("delete called outside of context")},deselect(){throw Error("deselect called outside of context")},moveSelection(){throw Error("moveSelection called outside of context")},selectArea(){throw Error("selectArea called outside of context")},selectId(){throw Error("selectId called outside of context")},selectPoint(){throw Error("selectPoint called outside of context")},setRectX(){throw Error("setRectX called outside of context")},setRectX1(){throw Error("setRectX1 called outside of context")},setRectX2(){throw Error("setRectX2 called outside of context")},setRectY(){throw Error("setRectY called outside of context")},setRectY1(){throw Error("setRectY1 called outside of context")},setRectY2(){throw Error("setRectY2 called outside of context")},setRegions(){throw Error("setRegions called outside of context")},setSelection(){throw Error("setSelection called outside of context")},updateRegion(){throw Error("updateRegion called outside of context")},updateRegionProperties(){throw Error("updateRegionProperties called outside of context")},updateSelectedRegions(){throw Error("updateSelectedRegions called outside of context")}},le=u.createContext(ce);function ue(e){const{input:t}=C(),n=ie(),o=e.canCreate??ce.canCreate,r=e.canDelete??ce.canDelete,i=e.canRead??ce.canRead,s=e.canUpdate??ce.canUpdate,[a,c]=u.useState(e.initRegions??ce.regions),[l,x]=u.useState(e.initSelection??ce.selection),h=u.useMemo((()=>{const e=new Map;for(const[t,n]of a)i(n)&&e.set(t,n);return e}),[i,a]),p=u.useMemo((()=>new Set(l).intersection(h)),[l,h]),f=u.useCallback(((e,o)=>{x((r=>{const i=new Set;for(const o of a.values()){const r=xe(o,n);e(E(r,t.xaxis?.unit==o.xunit,t.yaxis?.unit==o.yunit))&&i.add(o.id)}return ae(r,i,o??se.replace)}))}),[n,t,a]),m=u.useCallback(((e,t)=>{const o=n[e.xunit],r=n[e.yunit];if(null==o)throw Error(`axis not found: ${e.xunit}`);if(null==r)throw Error(`axis not found: ${e.yunit}`);return{...e,...H(o,r,t(X(o,r,e)))}}),[n]),y=u.useCallback(((e,t)=>{o&&(c((t=>new Map(t).set(e.id,e))),t?.autoSelect&&x(new Set([e.id])))}),[o]),g=u.useCallback((()=>{c((e=>{const t=new Map;for(const[n,o]of e)l.has(n)&&r(o)||t.set(n,o);return t})),x(new Set)}),[r,l]),v=u.useCallback((()=>{x(new Set)}),[]),b=u.useCallback(((e,n)=>{c((o=>new Map(Array.from(o,(o=>{let[r,i]=o;return l.has(r)&&s(i)?[r,m(i,(o=>({x:S(o.x+(t.xaxis?.unit==i.xunit?e:0),0,1-o.width),y:S(o.y+(t.yaxis?.unit==i.yunit?n:0),0,1-o.height),width:o.width,height:o.height})))]:[r,i]})))))}),[s,t,l,m]),w=u.useCallback(((e,t)=>{f((t=>null!=function(e,t){const n=Math.max(e.x,t.x),o=Math.max(e.y,t.y),r=Math.min(e.x+e.width,t.x+t.width)-n,i=Math.min(e.y+e.height,t.y+t.height)-o;return r<=0||i<=0?null:{x:n,y:o,width:r,height:i}}(t,e)),t)}),[f]),j=u.useCallback(((e,t)=>{x((n=>ae(n,new Set([e]),t??se.replace)))}),[]),k=u.useCallback(((e,t)=>{f((t=>function(e,t){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}(t,e)),t)}),[f]),z=u.useCallback(((e,t)=>{s(e)&&c((n=>new Map(n).set(e.id,m(e,(e=>({x:S(e.x+t,0,1-e.width),y:e.y,width:e.width,height:e.height}))))))}),[s,m]),A=u.useCallback((()=>{}),[]),M=u.useCallback(((e,t)=>{s(e)&&c((n=>new Map(n).set(e.id,m(e,(e=>({x:e.x,y:e.y,width:S(e.width+t,.01,1-e.x),height:e.height}))))))}),[s,m]),R=u.useCallback(((e,t)=>{s(e)&&c((n=>new Map(n).set(e.id,m(e,(e=>({x:e.x,y:S(e.y+t,0,1-e.height),width:e.width,height:e.height}))))))}),[s,m]),N=u.useCallback(((e,t)=>{s(e)&&c((n=>new Map(n).set(e.id,m(e,(e=>({x:e.x,y:S(e.y+t,0,e.y+e.height-.01),width:e.width,height:S(e.height-Math.max(t,-e.y),.01,1-e.y)}))))))}),[s,m]),P=u.useCallback(((e,t)=>{s(e)&&c((n=>new Map(n).set(e.id,m(e,(e=>({x:e.x,y:e.y,width:e.width,height:S(e.height+t,.01,1-e.y)}))))))}),[s,m]),D=u.useCallback(((e,t)=>{c((n=>{const o=n.get(e);return o&&s(o)?new Map(n).set(e,"function"==typeof t?t(o):t):n}))}),[s]),T=u.useCallback(((e,t)=>{D(e,(e=>({...e,properties:"function"==typeof t?t(e.properties):t})))}),[D]),L=u.useCallback((e=>{c((t=>{const n=new Map(t);for(const o of p){const r=t.get(o);r&&(s(r)&&n.set(o,"function"==typeof e?e(r):e))}return n}))}),[s,p]);return(0,d.jsx)(le.Provider,{children:e.children,value:{canCreate:o,regions:a,selection:l,transformedRegions:h,transformedSelection:p,canDelete:r,canRead:i,canUpdate:s,create:y,deleteSelection:g,deselect:v,moveSelection:b,render:e.render,selectArea:w,selectId:j,selectPoint:k,setRectX:z,setRectX1:A,setRectX2:M,setRectY:R,setRectY1:N,setRectY2:P,setRegions:c,setSelection:x,updateRegion:D,updateRegionProperties:T,updateSelectedRegions:L}})}function de(){return u.useContext(le)}function xe(e,t){const n=t[e.xunit],o=t[e.yunit];if(null==n)throw Error(`axis not found: ${e.xunit}`);if(null==o)throw Error(`axis not found: ${e.yunit}`);return X(n,o,e)}function he(e){switch(!0){case e.ctrlKey||e.metaKey:return se.invert;case e.shiftKey:return se.add;case e.altKey:return se.subtract;default:return se.replace}}function pe(e){const t=de(),n=u.useMemo((()=>{const n=e.fn(t.regions),o=new Set(t.selection).intersection(n);return{...t,transformedRegions:n,transformedSelection:o}}),[t,e.fn]);return(0,d.jsx)(le.Provider,{children:e.children,value:n})}function fe(e){const t=de(),n=M(),o=U(),r=e.children??t.render,i=u.useMemo((()=>{const t=E(X(n.xaxis,n.yaxis,e.region),n.xaxis.unit==e.region.xunit,n.yaxis.unit==e.region.yunit);if(Number.isNaN(t.x))return null;if(Number.isNaN(t.y))return null;if(Number.isNaN(t.width))return null;if(Number.isNaN(t.height))return null;const r=`0 0 ${t.width*e.dimensions.x*o.state.zoom.x} ${t.height*e.dimensions.y*o.state.zoom.y}`;return{className:e.selected?"annotation annotation-selected":"annotation",fontSize:"12pt",height:String(t.height),preserveAspectRatio:"none",viewBox:r,width:String(t.width),x:String(t.x),y:String(t.y)}}),[n.xaxis,n.yaxis,e.dimensions,e.region,e.selected,o.state.zoom]);return(0,d.jsx)(d.Fragment,{children:i&&r?.({...e,svgProps:i})})}const me=5*Math.PI/4,ye=-Math.PI/4;let ge=function(e){return e[e.CounterClockwise=-1]="CounterClockwise",e[e.Clockwise=1]="Clockwise",e}({});function ve(e){const t=u.useRef(null),{x:n,y:o}=u.useMemo((()=>{const t=me-e.state*(me-ye);return{x:4*Math.cos(t)/5,y:4*-Math.sin(t)/5}}),[e.state]);return B(t,u.useCallback((t=>{let{dy:n,event:o}=t;e.setState(n*(e.direction??ge.Clockwise)/(o.ctrlKey||o.metaKey?1e3:100))}),[e.setState,e.direction])),(0,d.jsxs)("svg",{ref:t,width:"60",height:"60",viewBox:"-1.1 -1.1 2.2 2.2",children:[(0,d.jsx)("path",{className:"encoder",d:`\n      M ${Math.cos(me)} ${-Math.sin(me)}\n      A 1 1 0 1 1 ${Math.cos(ye)} ${-Math.sin(ye)}\n    `}),(0,d.jsx)("circle",{className:"encoder-marker",cx:n,cy:o,r:"0.10"}),(0,d.jsx)("text",{className:"encoder-text",textAnchor:"middle",x:"0",y:"0.15",children:e.format?.(e.value)??e.value.toFixed(2)}),e.label&&(0,d.jsx)("text",{className:"encoder-text",textAnchor:"middle",x:"0",y:"0.45",children:1==e.label?e.unit:e.label})]})}ve.X=function(e){const t=ie(),n=de(),o=xe(e.region,t);return(0,d.jsx)(ve,{direction:e.direction,format:e.format,label:e.label,setState:t=>n.setRectX(e.region,t),state:o.x,unit:e.region.xunit,value:e.region.x})},ve.X2=function(e){const t=de(),n=ie(),o=xe(e.region,n);return(0,d.jsx)(ve,{direction:e.direction,format:e.format,label:e.label,setState:n=>t.setRectX2(e.region,n),state:o.width,unit:e.region.xunit,value:e.region.width})},ve.Y1=function(e){const t=de(),n=ie(),o=xe(e.region,n);return(0,d.jsx)(ve,{direction:e.direction,format:e.format,label:e.label,setState:n=>t.setRectY1(e.region,n),state:1-o.y,unit:e.region.yunit,value:e.region.y+e.region.height})},ve.Y2=function(e){const t=de(),n=ie(),o=xe(e.region,n);return(0,d.jsx)(ve,{direction:e.direction,format:e.format,label:e.label,setState:n=>t.setRectY2(e.region,n),state:1-o.y-o.height,unit:e.region.yunit,value:e.region.y})};const be={onKeyUps:{current:new Set},onKeyDowns:{current:new Set}},we=u.createContext(be);function je(e){const t=u.useRef(new Set),n=u.useRef(new Set);return u.useEffect((()=>{function e(e){for(const t of n.current)t(e)}function o(e){for(const n of t.current)n(e)}return window.addEventListener("keydown",e),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",o)}}),[]),(0,d.jsx)(we.Provider,{value:{onKeyUps:t,onKeyDowns:n},children:e.children})}function Ce(e){const{onKeyUps:t,onKeyDowns:n}=u.useContext(we);return u.useEffect((()=>{function o(t){e.onKeyDown&&t.key===e.bind&&e.onKeyDown(t)}function r(t){e.onKeyUp&&t.key===e.bind&&e.onKeyUp(t)}return n.current&&n.current.add(o),t.current&&t.current.add(r),()=>{n.current&&n.current.delete(o),t.current&&t.current.delete(r)}}),[e.onKeyDown,e.onKeyUp,e.bind,t,n]),(0,d.jsx)(d.Fragment,{})}function Se(e){return fetch(e).then((e=>{if(!e.ok)throw Error(`Failed to load audio: ${e.status} ${e.statusText}`);return e.arrayBuffer()})).then((e=>(new AudioContext).decodeAudioData(e)))}const ke={audioContext:null,buffer:null,fx:{},state:{pause:!0,seek:0,timecode:0},transport:{play:()=>{throw Error("play called outside of context")},stop:()=>{throw Error("stop called outside of context")},seek:()=>{throw Error("seek called outside of context")},getSeek:()=>{throw Error("getSeek called outside of context")}}},ze=u.createContext(ke);function Ae(e){const t=u.useMemo((()=>e.audioContext??new AudioContext),[e.audioContext]),[n,o]=u.useState(ke.state),r=u.useMemo((()=>({play:e=>{o((n=>{const o=e??(n.pause?n.seek:t.currentTime-n.timecode);return{pause:!1,seek:o,timecode:t.currentTime-o}}))},seek:n=>{o((o=>{const r=S("function"==typeof n?n(o.pause?o.seek:t.currentTime-o.timecode):n,0,e.buffer.duration),i=t.currentTime-r;return{...o,seek:r,timecode:i}}))},stop:e=>{o((n=>{const o=e??(n.pause?n.seek:t.currentTime-n.timecode);return{pause:!0,seek:o,timecode:t.currentTime-o}}))},getSeek:e=>e.pause?e.seek:t.currentTime-e.timecode})),[t,e.buffer.duration]);return(0,d.jsx)(ze.Provider,{children:e.children,value:{audioContext:t,buffer:e.buffer,fx:e.fx??ke.fx,state:n,transport:r}})}function Me(){return u.useContext(ze)}function Re(e){const t=u.useContext(ze),n=u.useMemo((()=>({...t,fx:e.fn(t.fx)})),[t,e.fn]);return(0,d.jsx)(ze.Provider,{children:e.children,value:n})}function Ee(e){const t=Me(),n=u.useRef(null),o=e.format??m.vE;return $(u.useCallback((()=>{n.current&&(n.current.textContent=o(t.transport.getSeek(t.state)))}),[t.transport.getSeek,t.state,o])),(0,d.jsx)("span",{ref:n,children:o(0)})}function Ne(){return Me().state.pause?(0,d.jsx)(u.Fragment,{}):(0,d.jsx)(Pe,{})}function Pe(){const{audioContext:e,buffer:t,fx:n,state:o,transport:r}=Me();return u.useEffect((()=>{if(null==e||null==t)return console.warn("Audio.Effect requires an AudioContext and AudioBuffer");let i=null,s=null,a=null;const c=()=>{n.loop?r.play(n.loop[0]):r.stop(0)},l=()=>{i&&(i.disconnect(),i=null),a&&(a.disconnect(),a=null),s&&(s.disconnect(),s=null)};s=e.createBiquadFilter(),s.type="highpass",s.frequency.value=S(n.hpf??0,0,22050),s.Q.value=20,a=e.createBiquadFilter(),a.type="lowpass",a.frequency.value=S(n.lpf??22050,0,22050),a.Q.value=20,i=e.createBufferSource(),i.buffer=t,i.addEventListener("ended",l),i.addEventListener("ended",c),i.connect(a),a.connect(s),s.connect(e.destination);const u=e.currentTime-o.timecode;if(n.loop){const e=Math.max(0,n.loop[1]-u);i.start(0,u,e)}else i.start(0,u);return()=>{i&&(i.removeEventListener("ended",c),i.removeEventListener("ended",l),i.stop()),l()}}),[e,t,o.timecode,r.play,r.stop,n.hpf,n.lpf,n.loop?.[0],n.loop?.[1]]),u.useEffect((()=>{const e=r.getSeek(o);n.loop&&(e<n.loop[0]||e>n.loop[1])&&r.play(n.loop[0])}),[n.loop,n.loop?.[0],n.loop?.[1],o,r.getSeek,r.play]),(0,d.jsx)(u.Fragment,{})}function De(e){e.setAttribute("display","none")}function Te(e){e.setAttribute("display","inline")}function Le(e,t,n,o){switch(void 0===n&&(n=t),void 0===o&&(o=String),e.constructor){case SVGTextElement:e.setAttribute("x",o(t));break;case SVGLineElement:e.setAttribute("x1",o(t)),e.setAttribute("x2",o(n));break;case SVGRectElement:e.setAttribute("x",o(t)),e.setAttribute("width",o(n))}}function Ue(e,t,n,o){switch(void 0===n&&(n=t),void 0===o&&(o=String),e.constructor){case SVGTextElement:e.setAttribute("y",o(t));break;case SVGLineElement:e.setAttribute("y1",o(t)),e.setAttribute("y2",o(n));break;case SVGRectElement:e.setAttribute("y",o(t)),e.setAttribute("height",o(n))}}function Ie(){const e=u.useRef(null),t=Me();return $(u.useCallback((()=>{if(e.current&&t.buffer){const n=t.transport.getSeek(t.state);Le(e.current,n/t.buffer.duration),Ue(e.current,0,1),Te(e.current)}}),[t.buffer,t.state,t.transport.getSeek])),(0,d.jsx)("line",{ref:e,className:"playhead",display:"none",x1:"0",y1:"0",x2:"0",y2:"100%"})}function $e(e){const t=f(),n=de(),o=u.useRef(null),r=u.useRef(null),i=U(),s=F(t),a=K(o);B(o,t.onWheel);const c=`\n    M 0 0\n    h 1\n    v 1\n    h -1\n    z\n    M ${i.state.scroll.x/i.state.zoom.x} ${i.state.scroll.y/i.state.zoom.y}\n    v ${1/i.state.zoom.y}\n    h ${1/i.state.zoom.x}\n    v ${-1/i.state.zoom.y}\n    z\n  `;return(0,d.jsxs)("svg",{className:"navigator",height:"100%",width:"100%",preserveAspectRatio:"none",viewBox:"0 0 1 1",...s,...e.svgProps,ref:o,children:[(0,d.jsx)("image",{href:e.src,width:"100%",height:"100%",preserveAspectRatio:"none"}),Array.from((e.ignoreRegionTransform?n.regions:n.transformedRegions).values(),(t=>(0,d.jsx)(fe,{children:e.children,dimensions:a,region:t,selected:(e.ignoreRegionTransform?n.selection:n.transformedSelection).has(t.id),viewerId:e.id},t.id))),(0,d.jsx)("path",{ref:r,className:"mask",d:c}),(0,d.jsx)(Ie,{})]})}function Fe(e){const{input:t,mouseup:n,unitUp:o}=C(),r=u.useRef(null),i=u.useRef(null),s=u.useRef(null),a=u.useRef(null),c=M();return $(u.useCallback((()=>{if(r.current&&i.current&&s.current&&a.current&&e.parent.current){const x=r.current;if(t.alt){const r=i.current,h=s.current,p=a.current;let f,y;Te(x),e.parent.current==t.focus||c.xaxis==t.xaxis?(f=W(c.xaxis,o.x),Le(r,n.rel.x,void 0,m.KN),Te(r)):(f="",De(r)),e.parent.current==t.focus||c.yaxis==t.yaxis?(y=W(c.yaxis,o.y),Ue(h,n.rel.y,void 0,m.KN),Te(h)):(y="",De(h)),function(e,t){e.textContent=t}(p,f&&y?`(${f}, ${y})`:f||y),l=p,u=n.rel,void 0===(d=m.KN)&&(d=String),u.x<.5?(Le(l,u.x,void 0,d),l.setAttribute("text-anchor","start")):(Le(l,u.x,void 0,d),l.setAttribute("text-anchor","end")),u.y<.5?(Ue(l,u.y+.01,void 0,d),l.setAttribute("dominant-baseline","hanging")):(Ue(l,u.y-.01,void 0,d),l.setAttribute("dominant-baseline","text-top"))}else De(x)}var l,u,d}),[t,n,c.xaxis,c.yaxis,e.parent,o])),(0,d.jsxs)("g",{ref:r,children:[(0,d.jsx)("line",{ref:i,className:"cursor-x",x1:"0",y1:"0",x2:"0",y2:"100%"}),(0,d.jsx)("line",{ref:s,className:"cursor-y",x1:"0",y1:"0",x2:"100%",y2:"0"}),(0,d.jsx)("text",{ref:a,className:"cursor-text",x:"0",y:"0",children:"0:00"})]})}function Ke(e){const t=u.useRef(null),n=de(),o=f(),r=U(),i=K(t),s=F(o);B(t,o.onWheel);const a=`${`translate(${-r.state.scroll.x}, ${-r.state.scroll.y})`} ${`scale(${r.state.zoom.x}, ${r.state.zoom.y})`}`;return(0,d.jsxs)("svg",{className:"visualization",height:"100%",width:"100%",...s,...e.svgProps,ref:t,children:[(0,d.jsx)("defs",{children:(0,d.jsx)("pattern",{id:"dotted-grid",x:"5",y:"5",width:"10",height:"10",patternUnits:"userSpaceOnUse",children:(0,d.jsx)("circle",{cx:"0",cy:"0",r:"1",fill:"black"})})}),(0,d.jsx)("rect",{className:"dotted-grid",width:"100%",height:"100%",fill:"url(#dotted-grid)"}),(0,d.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 1 1",preserveAspectRatio:"none",children:(0,d.jsxs)("g",{transform:a,children:[(0,d.jsx)("image",{preserveAspectRatio:"none",href:e.src,width:"100%",height:"100%"}),Array.from((e.ignoreRegionTransform?n.regions:n.transformedRegions).values(),(t=>(0,d.jsx)(fe,{children:e.children,dimensions:i,region:t,selected:(e.ignoreRegionTransform?n.selection:n.transformedSelection).has(t.id),viewerId:e.id},t.id))),e.showSelection&&(0,d.jsx)(Be,{}),(0,d.jsx)(Ie,{})]})}),(0,d.jsx)(Fe,{parent:t})]})}function Be(){const e=u.useRef(null),t=C(),n=M();return $(u.useCallback((()=>{var o,r,i;e.current&&(1&t.input.buttons?(Te(e.current),o=e.current,r=E(R(t.mousedown.abs,t.mouseup.abs),n.xaxis===t.input.xaxis,n.yaxis===t.input.yaxis),void 0===i&&(i=String),o.setAttribute("x",i(r.x)),o.setAttribute("y",i(r.y)),o.setAttribute("width",i(r.width)),o.setAttribute("height",i(r.height))):De(e.current))}),[n.xaxis,n.yaxis,t.input,t.mousedown,t.mouseup])),(0,d.jsx)("rect",{ref:e,className:"selection",x:"0",y:"0",width:"0",height:"0"})}},9359:(e,t,n)=>{n.d(t,{A:()=>a});n(4041);var o=n(213),r=n(1085);function i(e){let{children:t,fallback:n}=e;return(0,o.A)()?(0,r.jsx)(r.Fragment,{children:t?.()}):n??null}var s=n(396);function a(e){const{siteConfig:t}=(0,s.A)();return(0,r.jsx)(i,{children:()=>e.children((e=>t.baseUrl+e),t),fallback:(0,r.jsx)("div",{children:"Loading..."})})}},1184:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var o=n(4041);const r={},i=o.createContext(r);function s(e){const t=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:t},e.children)}}}]);